# å¯¦ä½œè¨ˆç•«ï¼šè¾²æ°‘æ›† PWA â€” æ²‰æµ¸å¼æ™‚é–“è—è¡“å“

**æ—¥æœŸ**ï¼š2026-02-17 | **è¦æ ¼**ï¼šSDD_v1/spec.md

**è¼¸å…¥**ï¼šåŠŸèƒ½è¦æ ¼èªªæ˜ (spec.md)ã€å°ˆæ¡ˆåŸå§‹ç¢¼

**æ³¨æ„**ï¼šæœ¬æ–‡ä»¶ç‚º Brownfieldï¼ˆæ¼¸é€²å¼å¼·åŒ–ï¼‰è¨ˆç•«â€”â€”å°ˆæ¡ˆå·²æœ‰å®Œæ•´çš„å¯é‹ä½œç¨‹å¼ç¢¼åŸºç¤ï¼Œæ­¤å¯¦ä½œè¨ˆç•«èšç„¦æ–¼ã€Œè¦æ ¼é©…å‹•ã€çš„ç³»çµ±åŒ–ç›¤é»èˆ‡æœªä¾†æ¼”é€²è·¯ç·šã€‚

---

## æ‘˜è¦

è¾²æ°‘æ›† PWA æ˜¯ä¸€æ¬¾å°‡å‚³çµ±è¾²æ›†æ•¸ä½åŒ–çš„æ²‰æµ¸å¼è¦–è½æ‡‰ç”¨ï¼Œæ¡ç”¨ Astro æ¡†æ¶ + TypeScript + äº‹ä»¶é©…å‹•æ¶æ§‹æ§‹å»ºã€‚æ ¸å¿ƒåŠŸèƒ½æ¶µè“‹äº”ç¨®æ“ä½œæ¨¡å¼çš„ç‹€æ…‹æ©Ÿç®¡ç†ã€è¾²æ›†æ•¸æ“šè¨ˆç®—å¼•æ“ã€4K èƒŒæ™¯åœ–ç‰‡è¼ªæ’­ç³»çµ±ã€éŸ³æ¨‚æ’­æ”¾å™¨ã€å‹•æ…‹ä¸»é¡Œå¼•æ“èˆ‡ PWA é›¢ç·šèƒ½åŠ›ã€‚æœ¬è¨ˆç•«åŸºæ–¼å·²å®Œæˆçš„ç¨‹å¼ç¢¼åŸºç¤ï¼Œç³»çµ±åŒ–å®šç¾©ç‰ˆé¢é…ç½®è¦ç¯„ã€æŒ‰éˆ•ç‹€æ…‹è½‰ç§»é‚è¼¯ã€äº‹ä»¶å¥‘ç´„èˆ‡å“è³ªé©—æ”¶æ¨™æº–ã€‚

---

## æŠ€è¡“ä¸Šä¸‹æ–‡ (Technical Context)

**èªè¨€ï¼ç‰ˆæœ¬**ï¼šTypeScript (ES2022+)ï¼Œå¼·åˆ¶ ES Modules  
**ä¸»è¦æ¡†æ¶**ï¼šAstro v4.16+ (ç¾¤å³¶æ¶æ§‹)  
**ä¸»è¦ç›¸ä¾æ€§**ï¼š@vite-pwa/astroã€lunar-javascriptï¼ˆæœ¬åœ°ç§»æ¤ï¼‰  
**å„²å­˜æ–¹å¼**ï¼šIndexedDBï¼ˆè‡ªè¨‚åª’é«”ï¼‰+ localStorageï¼ˆåå¥½è¨­å®šï¼‰â€” é›¶ä¼ºæœå™¨  
**æ¸¬è©¦**ï¼šESLint Zero Errorsï¼ˆå‰ç«¯ï¼‰ã€Ruffï¼ˆPython è…³æœ¬ï¼‰  
**ç›®æ¨™å¹³å°**ï¼šModern Browsers (Chrome 90+, Safari 15+, Firefox 90+)ï¼ŒPWA å®‰è£  
**å°ˆæ¡ˆé¡å‹**ï¼šSingle-page PWAï¼ˆAstro SSG è¼¸å‡ºï¼‰  
**æ•ˆèƒ½ç›®æ¨™**ï¼šé¦–å± â‰¤8sï¼ˆå«è¶…æ™‚ä¿è­·ï¼‰ã€æ¨¡å¼åˆ‡æ› â‰¤200msã€èƒŒæ™¯å‹•ç•« 60fps  
**é™åˆ¶æ¢ä»¶**ï¼š
- è¾²æ›†è¨ˆç®—ç¯„åœ 1900-2100
- å¼·åˆ¶ HTTPSï¼ˆéŸ³è¨Šä¸²æµï¼‰
- è§¸æ§å€åŸŸ â‰¥44Ã—44px
- é›¶ç¬¬ä¸‰æ–¹ UI æ¡†æ¶ï¼ˆç´”åŸç”Ÿ DOM APIï¼‰

**è¦æ¨¡ï¼ç¯„ç–‡**ï¼š  
- 5 ç¨®æ“ä½œæ¨¡å¼  
- 7 ç¨®è‰²å½©ä¸»é¡Œ  
- 20+ ç¨® CustomEvent å¥‘ç´„  
- ~30 å€‹ TypeScript æ¨¡çµ„  
- ~15 å€‹ CSS æ¨£å¼æ¨¡çµ„  
- ~10 å€‹ Astro çµ„ä»¶  

---

## å°ˆæ¡ˆæ†²ç« æª¢æŸ¥ (Constitution Check)

| æ†²ç« åŸå‰‡ | ç¬¦åˆç‹€æ…‹ | å‚™è¨» |
|----------|----------|------|
| I. æ•¸ä½é«˜ç´šæ„Ÿå„ªå…ˆ | âœ… | ç»ç’ƒæ“¬æ…‹ã€1.6s çµ²ç¶¢è½‰å ´ã€60fps å‹•ç•«ã€ç„¡å™ªé» |
| II. æ¨¡çµ„åŒ–èˆ‡è·è²¬åˆ†é›¢ | âœ… | Manager/Handler/Renderer/Orchestrator å››å±¤+ åˆ†é›¢ |
| III. é¡å‹å®‰å…¨ä¸å¯å”å•† | âœ… | CustomEvent å…¨æ³›å‹å®šç¾©æ–¼ types.ts |
| IV. å“è³ªé–€æª» | âœ… | ESLint Zero Errors æ”¿ç­–åŸ·è¡Œä¸­ |
| V. éŸ¿æ‡‰å¼è¡Œå‹•å„ªå…ˆ | âœ… | clamp()ã€vw/vhã€4 æ®µæ–·é» |
| VI. å‘½åå³æ–‡ä»¶ | âœ… | kebab-case æª”æ¡ˆã€BEM-inspired class |
| VII. ç°¡å–®æ€§ YAGNI | âœ… | ç„¡ç¬¬ä¸‰æ–¹ UI æ¡†æ¶ã€åŸç”Ÿ DOM |

---

## å°ˆæ¡ˆçµæ§‹

### æ–‡ä»¶ï¼ˆæœ¬åŠŸèƒ½ â€” SDD_v1ï¼‰

```text
SDD_v1/
â”œâ”€â”€ constitution.md      # å°ˆæ¡ˆæ†²ç« ï¼ˆ/speckit.constitutionï¼‰
â”œâ”€â”€ spec.md              # åŠŸèƒ½è¦æ ¼èªªæ˜ï¼ˆ/speckit.specifyï¼‰
â”œâ”€â”€ plan.md              # æœ¬æ–‡ä»¶ï¼ˆ/speckit.planï¼‰
â””â”€â”€ tasks.md             # ä»»å‹™æ¸…å–®ï¼ˆ/speckit.tasksï¼‰
```

### åŸå§‹ç¢¼ï¼ˆRepository æ ¹ç›®éŒ„ï¼‰

```text
lunar-calendar/
â”œâ”€â”€ astro.config.mjs                    # Astro + PWA è¨­å®š
â”œâ”€â”€ tsconfig.json                       # TypeScript è¨­å®šï¼ˆ@/ â†’ src/ï¼‰
â”œâ”€â”€ package.json                        # ç›¸ä¾æ€§èˆ‡ npm scripts
â”œâ”€â”€ eslint.config.js                    # ESLint å“è³ªè¦ç¯„
â”‚
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ gallery/                    # å­£ç¯€/ç¯€æ…¶åœ–ç‰‡è³‡æº
â”‚   â”‚   â”‚   â”œâ”€â”€ gallery.json            # åœ–ç‰‡æ¸…å–® manifest
â”‚   â”‚   â”‚   â”œâ”€â”€ spring/ summer/ autumn/ winter/ default/
â”‚   â”‚   â”œâ”€â”€ fonts/                      # å­—é«”è³‡æº
â”‚   â”‚   â”œâ”€â”€ audio/                      # éŸ³è¨Šè³‡æº
â”‚   â”‚   â””â”€â”€ icons/                      # PWA åœ–ç¤º
â”‚   â””â”€â”€ radio_music.html                # é›»å°ç®¡ç†é é¢
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â””â”€â”€ index.astro                 # å”¯ä¸€é é¢å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/
â”‚   â”‚   â””â”€â”€ Layout.astro                # å…¨åŸŸ HTML éª¨æ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Hero/                       # è‹±é›„å€å¡Šçµ„ä»¶ç¾¤
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroSection.astro       # çµ„åˆå®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroBackground.astro    # 4K èƒŒæ™¯åœ–å®¹å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroHeader.astro        # é ‚éƒ¨è³‡è¨Šæ¢
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroDock.astro          # åº•éƒ¨å°èˆª Dock
â”‚   â”‚   â”‚   â”œâ”€â”€ HeroGallerySubmenu.astro  # è—å»Šæ§åˆ¶é¸å–®
â”‚   â”‚   â”‚   â”œâ”€â”€ WelcomeOverlay.astro    # æ­¡è¿é®ç½©å±¤
â”‚   â”‚   â”‚   â””â”€â”€ MusicPlayer.astro       # éŸ³è¨Šå…ƒç´ 
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Calendar/                   # æ—¥æ›†å€å¡Šçµ„ä»¶ç¾¤
â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarBoard.astro     # æ—¥æ›†ä¸»æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ CalendarHeader.astro    # æ—¥æ›†æ¨™é¡Œ
â”‚   â”‚   â”‚   â””â”€â”€ CalendarGridContainer.astro  # æ—¥æ›†ç¶²æ ¼å®¹å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Panels/                     # é¢æ¿çµ„ä»¶ç¾¤
â”‚   â”‚       â””â”€â”€ FloatingPanels.astro    # æµ®å‹•é¢æ¿ï¼ˆå¹´æœˆ/ä»Šæ—¥/FAQï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ types.ts                    # å…¨åŸŸå‹åˆ¥å®šç¾© â­
â”‚   â”‚   â”œâ”€â”€ SCRIPTS_ARCHITECTURE.md     # è…³æœ¬æ¶æ§‹èªªæ˜æ–‡ä»¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ app/                        # æ‡‰ç”¨å±¤
â”‚   â”‚   â”‚   â”œâ”€â”€ appController.ts        # åˆå§‹åŒ–æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ stateManager.ts         # å…¨åŸŸç‹€æ…‹ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ eventOrchestrator.ts    # äº‹ä»¶ç·¨æ’ä¸­å¿ƒ
â”‚   â”‚   â”‚   â”œâ”€â”€ updateManager.ts        # æ›´æ–°ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ resourceLoader.ts       # è³‡æºåŠ è¼‰å™¨ï¼ˆé€²åº¦æ¢ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ core/                       # æ ¸å¿ƒé‹ç®—
â”‚   â”‚   â”‚   â”œâ”€â”€ lunar.ts                # è¾²æ›†è¨ˆç®—å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ holidayService.ts       # æ”¿åºœå‡æ—¥æœå‹™
â”‚   â”‚   â”‚   â””â”€â”€ appConfig.ts            # æ‡‰ç”¨è¨­å®š
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ hero/                       # è‹±é›„å€å¡Šé‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ hero-main.ts            # Hero åˆå§‹åŒ–å…¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ eventHandlers.ts        # Hero äº‹ä»¶è™•ç†ï¼ˆæ§åˆ¶å™¨ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ imageManager.ts         # åœ–ç‰‡åŠ è¼‰èˆ‡ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ galleryManager.ts       # è—å»Šæ¨¡å¼ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ galleryStorage.ts       # è‡ªè¨‚åœ–ç‰‡ IndexedDB å­˜å–
â”‚   â”‚   â”‚   â”œâ”€â”€ slideshowManager.ts     # è¼ªæ’­è¨ˆæ™‚ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ musicPlayer.ts          # éŸ³æ¨‚æ’­æ”¾å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ uiManager.ts            # UI ç‹€æ…‹ç®¡ç†ï¼ˆFacadeï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ headerManager.ts        # é ‚éƒ¨ Header ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ idleManager.ts          # é–’ç½®åµæ¸¬
â”‚   â”‚   â”‚   â”œâ”€â”€ imageRules.ts           # åœ–ç‰‡è¦å‰‡å¸¸é‡
â”‚   â”‚   â”‚   â”œâ”€â”€ parallaxManager.ts      # è¦–å·®æ•ˆæœ
â”‚   â”‚   â”‚   â”œâ”€â”€ touchHandler.ts         # è§¸æ§æ‰‹å‹¢è™•ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ pwaHandler.ts           # PWA å®‰è£è™•ç†
â”‚   â”‚   â”‚   â””â”€â”€ types.ts                # Hero å€åŸŸå°ˆç”¨å‹åˆ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/               # å­äº‹ä»¶è™•ç†å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ modeHandler.ts      # æ¨¡å¼è½‰æ›å‰¯ä½œç”¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ navigationHandler.ts  # å°èˆªäº‹ä»¶è™•ç†
â”‚   â”‚   â”‚   â””â”€â”€ ui/                     # UI å­ç®¡ç†å™¨
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ calendar/                   # æ—¥æ›†é‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ calendar-board.ts       # æ—¥æ›†åˆå§‹åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ calendarRenderer.ts     # æ—¥æ›†æ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ calendarCellBuilder.ts  # æ—¥æœŸæ ¼æ§‹å»ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ calendarEventHandlers.ts  # æ—¥æ›†äº‹ä»¶è™•ç†
â”‚   â”‚   â”‚   â””â”€â”€ types.ts               # æ—¥æ›†å°ˆç”¨å‹åˆ¥
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ panels/                     # é¢æ¿é‚è¼¯
â”‚   â”‚   â”‚   â”œâ”€â”€ floating-panels.ts      # é¢æ¿åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ ...                     # Renderer/Handler
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â””â”€â”€ layout-main.ts          # å…¨åŸŸä½ˆå±€å·¥å…·
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ui/                         # é€šç”¨ UI å·¥å…·
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ generated/                  # è‡ªå‹•ç”Ÿæˆ
â”‚   â”‚       â”œâ”€â”€ audioManifest.ts        # éŸ³è¨Šæª”æ¡ˆæ¸…å–®
â”‚   â”‚       â””â”€â”€ galleryManifest.ts      # åœ–ç‰‡æª”æ¡ˆæ¸…å–®
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ tokens.css                  # è¨­è¨ˆè®Šé …ï¼ˆDesign Tokensï¼‰
â”‚   â”‚   â”œâ”€â”€ global.css                  # å…¨åŸŸæ¨£å¼èˆ‡æ¨¡å¼å¯è¦‹æ€§
â”‚   â”‚   â”œâ”€â”€ hero.css                    # Hero å€å¡ŠåŸºç¤
â”‚   â”‚   â”œâ”€â”€ calendar.css                # æ—¥æ›†åŸºç¤
â”‚   â”‚   â”œâ”€â”€ panels.css                  # é¢æ¿åŸºç¤
â”‚   â”‚   â”œâ”€â”€ glass-card.css              # ç»ç’ƒæ“¬æ…‹å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ splash.css                  # è¼‰å…¥ç•«é¢
â”‚   â”‚   â”œâ”€â”€ calendar-themes.css         # ä¸»é¡Œå…¥å£
â”‚   â”‚   â”œâ”€â”€ hero/                       # Hero ç´°åˆ†æ¨£å¼
â”‚   â”‚   â”œâ”€â”€ calendar/                   # æ—¥æ›†ç´°åˆ†æ¨£å¼
â”‚   â”‚   â”œâ”€â”€ panels/                     # é¢æ¿ç´°åˆ†æ¨£å¼
â”‚   â”‚   â””â”€â”€ themes/                     # 7 ç¨®ä¸»é¡Œ CSS
â”‚   â”‚
â”‚   â””â”€â”€ data/
â”‚       â””â”€â”€ calendarQuotes.ts           # æ—¥æ›†åè¨€è³‡æ–™
â”‚
â”œâ”€â”€ scripts/                            # å»ºç½®è…³æœ¬
â”‚   â”œâ”€â”€ generate_gallery_manifest.py    # åœ–ç‰‡æ¸…å–®ç”Ÿæˆ
â”‚   â”œâ”€â”€ generate-gallery-manifest.js    # JS ç‰ˆåœ–ç‰‡æ¸…å–®
â”‚   â””â”€â”€ generate-audio-manifest.js      # éŸ³è¨Šæ¸…å–®ç”Ÿæˆ
â”‚
â”œâ”€â”€ SDD/                                # åŸå§‹è¨­è¨ˆæ–‡ä»¶
â”‚   â”œâ”€â”€ spec-context.md
â”‚   â”œâ”€â”€ tech_context.md
â”‚   â”œâ”€â”€ UI_FLOW_LOGIC.md
â”‚   â”œâ”€â”€ ui_ux_design_context.md
â”‚   â””â”€â”€ è‰²ç³»æ–¹æ¡ˆ.md
â”‚
â””â”€â”€ .agent/                             # AI é–‹ç™¼æŒ‡å¼•
    â”œâ”€â”€ CODING_STANDARDS.md
    â”œâ”€â”€ NAMING_STANDARDS.md
    â””â”€â”€ skills/premium-ui-design/SKILL.md
```

**çµæ§‹æ±ºç­–**ï¼šæ­¤ç‚ºå–®ä¸€å°ˆæ¡ˆ Single-page PWAï¼ŒåŸå§‹ç¢¼ä½æ–¼ `src/`ï¼Œéœæ…‹è³‡æºä½æ–¼ `public/`ï¼Œå»ºç½®è…³æœ¬ä½æ–¼æ ¹ç›®éŒ„ `scripts/`ã€‚é‚è¼¯æŒ‰åŠŸèƒ½é ˜åŸŸ (feature) åˆ†ç›®éŒ„ï¼ŒéæŒ‰æŠ€è¡“å±¤ç´šã€‚

---

## æ•¸ä½é«˜ç´šæ„Ÿå¯¦ä½œæŠ€è¡“æŒ‡å— (Premium Visual Implementation Technical Guide)

ç‚ºé”æˆã€Œæ™‚é–“è—è¡“å“ã€çš„é«˜åº¦è³ªæ„Ÿï¼Œå¯¦ä½œéšæ®µå¿…é ˆåš´æ ¼åŸ·è¡Œä»¥ä¸‹è¦–è¦ºæŠ€è¡“è¦ç¯„ï¼š

### 1. å±¤ç–Šç»ç’ƒæ“¬æ…‹ (Ultra Glassmorphism Strategy)

å‚³çµ±çš„å–®å±¤æ¨¡ç³Š (`backdrop-filter: blur`) å®¹æ˜“é¡¯å¾—æ•¸ä½æ„Ÿéé‡ã€‚æœ¬å°ˆæ¡ˆæ¡ç”¨ä¸‰å±¤å †ç–Šç­–ç•¥ï¼š

1.  **åº•å±¤æ¨¡ç³Š (Foundation Blur)**ï¼š`backdrop-filter: blur(24px) saturate(180%)`ã€‚å¢åŠ é£½å’Œåº¦èƒ½æå‡èƒŒæ™¯åœ–ç‰‡è‰²å½©çš„é€šé€æ„Ÿã€‚
2.  **æè³ªç´‹ç† (Material Texture overlay)**ï¼šä½¿ç”¨ä¸€å€‹æ¥µä½é€æ˜åº¦ (1-3%) çš„ç™½è‰²é›œè¨Šè²¼åœ– (`noise.webp` æˆ– CSS ç”Ÿæˆçš„é‡ç–Š `repeating-radial-gradient`)ã€‚é€™èƒ½æ¨¡æ“¬ç‰©ç†ç»ç’ƒè¡¨é¢çš„å¾®å°ç‘•ç–µï¼Œå¢åŠ è³ªæ„Ÿã€‚
3.  **é«˜å…‰é‚Šç·£ (Specular Border)**ï¼š
    *   `1px solid` çµåˆ `linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 50%, rgba(255,255,255,0.1) 100%)`ã€‚
    *   å·¦ä¸Šè§’è¼ƒäº®ï¼Œæ¨¡æ“¬å…‰ç·šå¾ä¸Šæ–¹æŠ•å°„çš„ç‰©ç†æ•ˆæœã€‚
4.  **å‹•æ…‹é™°å½±ç–ŠåŠ  (Dynamic Shadow Depth)**ï¼š[æ–°å¢] åœ¨ç»ç’ƒé¢æ¿ä¸‹æ–¹ç–ŠåŠ æ¥µç´°å¾®çš„ `box-shadow`ï¼Œå…¶è‰²å½©æ‡‰å‹•æ…‹å–è‡ªç•¶å‰èƒŒæ™¯è‰²çš„æ·±è‰²èª¿ï¼Œæ¨¡æ“¬å…‰å½±é€å°„æ•ˆæœã€‚

### 2. äº®åº¦æ„ŸçŸ¥èˆ‡ç’°å¢ƒé©é… (Luminance Awareness Strategy) [æ–°å¢]

ç‚ºäº†ç¢ºä¿ UI åœ¨ä¸åŒ 4K èƒŒæ™¯ä¸‹çš„æ¥µè‡´é–±è®€æ€§ï¼š

*   **äº®åº¦åµæ¸¬é‚è¼¯**ï¼šåˆ©ç”¨ä¸å¯è¦‹çš„ Canvas å° Hero åº•éƒ¨å°èˆªå€åŸŸï¼ˆDock èƒŒæ™¯ï¼‰èˆ‡é ‚éƒ¨è³‡è¨Šæ¢å€åŸŸé€²è¡Œ `getImageData` æ¡æ¨£ï¼Œè¨ˆç®—å¹³å‡äº®åº¦ (Luminance)ã€‚
*   **é–¾å€¼è§¸ç™¼**ï¼šè‹¥ Luminance > 180 (äº®è‰²èƒŒæ™¯)ï¼Œè‡ªå‹•ç‚º body åŠ å…¥ `.light-bg-mode`ã€‚
*   **è¦–è¦ºè£œå„Ÿ**ï¼šåœ¨ `.light-bg-mode` ä¸‹ï¼Œå¼·åˆ¶ç‚ºç™½è‰²æ–‡å­—å¢åŠ  `text-shadow: 0 1px 4px rgba(0,0,0,0.4)`ï¼Œä¸¦å°‡ç»ç’ƒèƒŒæ¿çš„ `backdrop-filter: saturate()` æå‡è‡³ 250% ä»¥å¢å¼·å°æ¯”ã€‚

### 3. ä¸»é¡Œç·©è¡èˆ‡å­£ç¯€å­—é«”ç´°ç¯€ (Typography & Smoothing) [æ›´æ–°]

ç•¶è‰²å½©ä¸»é¡Œï¼ˆå¦‚ Spring â†’ Summerï¼‰æˆ– Dock è‰²ç³»ï¼ˆGold â†” Silverï¼‰åˆ‡æ›æ™‚ï¼š

*   **å­£ç¯€æ’ç‰ˆç´°ç¯€**ï¼š
    *   **Spring/Summer**ï¼š`letter-spacing: 0.05em`, `font-weight: 300` (è¼•ç›ˆæ„Ÿ)ã€‚
    *   **Autumn/Winter**ï¼š`letter-spacing: 0.02em`, `font-weight: 400` (å‡é‡æ„Ÿ)ã€‚
*   **é™°å½±éæ¸¡é–**ï¼šCSS è®Šæ•¸æ‡‰åŒ…å« `--theme-shadow` èˆ‡ `--theme-text-shadow`ã€‚
*   **å‹•æ…‹ç·©å‹•**ï¼šåœ¨ä¸»é¡Œåˆ‡æ›çš„æ™‚é–“è»¸å…§ (`0.6s`)ï¼Œä½¿ç”¨èˆ‡ä¸»è‰²èª¿ä¸€è‡´çš„ `cubic-bezier(0.22, 1, 0.36, 1)` éæ¸¡ã€‚

### 4. èªæ„åŒ–è½‰å ´æ™‚é•·èˆ‡ä¸­æ–·ä¿è­· (Transition Strategy) [æ–°å¢]

*   **è½‰å ´æ™‚é•·ç­–ç•¥**ï¼š
    *   **é‡å¤§åˆ‡æ› (Welcome â†’ App)**ï¼š1.6s (æ¥µç·»å„€å¼æ„Ÿ)ã€‚
    *   **å°èˆªåˆ‡æ› (Month/Image Change)**ï¼š0.6s - 0.8s (å…¼é¡§æµæš¢èˆ‡ç›´è¦º)ã€‚
*   **ä¸­æ–·ä¿è­· (Interruption Safety)**ï¼šå¯¦ä½œã€ŒTransition Chainingã€æ©Ÿåˆ¶ã€‚è‹¥åœ¨ A å‹•ç•«åŸ·è¡Œä¸­è§¸ç™¼ Bï¼Œç³»çµ±ä¸åŸ·è¡Œç¡¬åˆ‡æ›ï¼Œè€Œæ˜¯å°‡ B è«‹æ±‚æ’å…¥ `Transition Lock` ä½‡åˆ—ï¼Œå¾… A å‹•ç•«ä¹‹ CSS `transitionend` è§¸ç™¼å¾Œå†å•Ÿå‹• Bï¼Œç¢ºä¿è¦–è¦ºçš„é€£çºŒæ€§ã€‚

### 5. èƒŒæ™¯å‘¼å¸æ„Ÿå‹•ç•« (Hero Background Breathing)

ç‚ºäº†è®“èƒŒæ™¯ä¸åƒ…åƒ…æ˜¯ä¸€å¼µåœ–ç‰‡ï¼ŒHeroBackground å¿…é ˆå¯¦ä½œç„¡æ„ŸçŸ¥å¾ªç’°å‹•ç•«ï¼š

*   **å‹•ç•«åƒæ•¸**ï¼š
    *   å‹•ç•«ï¼š`breathing-animation 60s ease-in-out infinite alternate`
    *   è®Šæ›ï¼š`scale(1.0)` â†’ `scale(1.06)`
*   **æŠ—é–ƒçˆè™•ç†**ï¼šä½¿ç”¨ `will-change: transform` æç¤ºç€è¦½å™¨å„ªåŒ–ã€‚
*   **åˆ‡æ›åŒæ­¥**ï¼šç•¶æ›´æ›èƒŒæ™¯åœ–æ™‚ï¼Œå¹³ç§»åˆ‡æ›å‹•ç•« (`1.6s`) æ‡‰å„ªæ–¼å‘¼å¸å‹•ç•«ï¼Œé¿å…å…©è€…è¡çªã€‚å»ºè­°å°‡å‘¼å¸å‹•ç•«å¥—ç”¨åœ¨å…§éƒ¨å®¹å™¨ï¼Œå°‡è½‰å ´å‹•ç•«å¥—ç”¨åœ¨å¤–å±¤å®¹å™¨ã€‚

---

## ç‰ˆé¢é…ç½®è©³ç´°è¦ç¯„ (Layout Architecture â€” Detailed)

æœ¬ç¯€ç‚ºæ ¸å¿ƒå¯¦ä½œæŒ‡å—ï¼Œè©³ç´°å®šç¾©æ¯å€‹ UI å€åŸŸçš„ç©ºé–“é—œä¿‚ã€Z è»¸å±¤ç´šã€éŸ¿æ‡‰å¼è¡Œç‚ºèˆ‡æ¨¡å¼æ„ŸçŸ¥é‚è¼¯ã€‚

### 1. å…¨åŸŸç‰ˆé¢çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              #loadingOverlay             â”‚ z: 10000 (åƒ…å•Ÿå‹•æ™‚)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              #appContainer               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        HeroBackground             â”‚  â”‚ z: 0 (æœ€åº•å±¤)
â”‚  â”‚        (å…¨è¢å¹• 4K èƒŒæ™¯åœ–)          â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    WelcomeOverlay           â”‚  â”‚  â”‚ z: 100005 (æ­¡è¿æ¨¡å¼)
â”‚  â”‚  â”‚    (ä»Šæ—¥è©³æƒ…ç´…å¡)            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    HeroHeader               â”‚  â”‚  â”‚ z: 2000
â”‚  â”‚  â”‚    (é ‚éƒ¨æ—¥æœŸè³‡è¨Šæ¢)          â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    CalendarBoard            â”‚  â”‚  â”‚ z: 50
â”‚  â”‚  â”‚    (æ—¥æ›†ç¶²æ ¼ + æ¨™é¡Œ)         â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    FloatingPanels           â”‚  â”‚  â”‚ z: 1100
â”‚  â”‚  â”‚    (+PanelBackOverlay z:1000)â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    å³ä¸Šå·¥å…·æŒ‰éˆ•ç¾¤            â”‚  â”‚  â”‚ z: 2000
â”‚  â”‚  â”‚    ğŸµ ğŸ–¼ï¸ â“                  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚    HeroDock (åº•éƒ¨å°èˆª)       â”‚  â”‚  â”‚ z: 100
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Z-Index åˆ†å±¤ç®¡ç†

```css
--z-index-hero-bg:         0       /* HeroBackgroundï¼šèƒŒæ™¯åº•åœ– */
--z-index-base:            1       /* ä¸»é«”å…§å®¹ */
--z-index-calendar-grid:   50      /* CalendarBoardï¼šæ—¥æ›†ç¶²æ ¼ */
--z-index-dock:            100     /* HeroDockï¼šåº•éƒ¨æ§åˆ¶åˆ— */
--z-index-panel-overlay:   1000    /* PanelBackOverlayï¼šé¢æ¿èƒŒæ™¯é®ç½© */
--z-index-panel:           1100    /* FloatingPanelsï¼šå½ˆå‡ºé¢æ¿ */
--z-index-header:          2000    /* HeroHeader + å³ä¸ŠæŒ‰éˆ•ç¾¤ */
--z-index-loading:         10000   /* loadingOverlayï¼šé¦–å±åŠ è¼‰ */
--z-index-welcome:         100005  /* WelcomeOverlayï¼šæ­¡è¿å¡ç‰‡ */
```

### 3. HeroDock ç‰ˆé¢ä½ˆå±€è©³è§£

HeroDock æ˜¯æ•´å€‹æ‡‰ç”¨æœ€é—œéµçš„äº’å‹•å…ƒä»¶ï¼Œå› ç‚ºå®ƒåœ¨ä¸åŒæ¨¡å¼ä¸‹å…·å‚™å®Œå…¨ä¸åŒçš„åŠŸèƒ½èªç¾©èˆ‡è¦–è¦ºè¡¨ç¾ã€‚

#### 3.1 Dock å°ç¨±ä½ˆå±€çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [â—€ Prev]  â”‚  [æ˜ ç•«] [ä¸­é–“æ§½ä½] [æ—¥æ›†]  â”‚  [Next â–¶]  â”‚
â”‚   æ­¥é€²éµ      â”‚          å…¥å£/åŠŸèƒ½ç¾¤          â”‚   æ­¥é€²éµ     â”‚
â”‚    (å·¦ç¿¼)    â”€â”¤â”€       (ä¸­å¤®å€åŸŸ)        â”€â”¤â”€   (å³ç¿¼)    â”‚
â”‚              â”‚                             â”‚              â”‚
â”‚  é‡‘è‰²/éŠ€è‰²   â”‚         å‹•æ…‹åˆ‡æ›              â”‚  é‡‘è‰²/éŠ€è‰²   â”‚
â”‚  (æ¨¡å¼åŒæ­¥)  â”‚  æ—¥æ›†æ¨¡å¼: [å¹´æœˆæŒ‰éˆ•]         â”‚  (æ¨¡å¼åŒæ­¥)  â”‚
â”‚              â”‚  æ˜ ç•«æ¨¡å¼: [è—å»Šé¸å–®]         â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†• åˆ†éš”ç·š      â†•                  â†•          â†• åˆ†éš”ç·š
  (é‡‘è‰²/éŠ€è‰²æ¼¸å±¤)                            (é‡‘è‰²/éŠ€è‰²æ¼¸å±¤)
```

#### 3.2 Dock åŠŸèƒ½ç¾¤çµ„åˆ‡æ›

| CSS Class | å¯è¦‹æ™‚æ©Ÿ | åŒ…å«å…ƒç´  | å‚™è¨» |
|-----------|----------|----------|------|
| `.group-calendar` | æ—¥æ›†æ¨¡å¼ (Calendar) | å¹´æœˆæŒ‰éˆ• `btnYearMonth` | é‡‘è‰²ç³» |
| `.group-image` (`.gallery-control-wrapper`) | æ˜ ç•«æ¨¡å¼ (Artwork) | è—å»Šé¸å–®è§¸ç™¼å™¨ | éŠ€ç™½è‰²ç³» |

**åˆ‡æ›é‚è¼¯**ï¼ˆå®šç¾©æ–¼ `ModeHandler.applyModeSideEffects()`ï¼‰ï¼š

```
é€²å…¥æ˜ ç•«æ¨¡å¼:
  â†’ .group-calendar { display: none }
  â†’ .group-image.gallery-control-wrapper { display: flex }
  â†’ Dock å…¨åŸŸè‰²ç³» â†’ éŠ€ç™½

é€²å…¥æ—¥æ›†æ¨¡å¼:
  â†’ .group-image { display: none }
  â†’ .group-calendar { display: flex }
  â†’ Dock å…¨åŸŸè‰²ç³» â†’ é¦™æª³é‡‘
```

#### 3.3 æ­¥é€²éµ `< >` åŠŸèƒ½è½‰ç¾©

æ­¥é€²éµçš„åŠŸèƒ½éš¨æ¨¡å¼è®ŠåŒ–â€”â€”æ­¤ç‚ºã€ŒåŠŸèƒ½è‰²ç³»æ­¸å±¬æ„Ÿã€è¨­è¨ˆå“²å­¸çš„æ ¸å¿ƒé«”ç¾ï¼š

| æ¨¡å¼ | `< >` åŠŸèƒ½ | è‰²ç³» | äº‹ä»¶ |
|------|-----------|------|------|
| **æ—¥æ›†æ¨¡å¼** | æœˆä»½æ­¥é€²ï¼ˆä¸Š/ä¸‹æœˆï¼‰ | é¦™æª³é‡‘ `#D4AF37` | `navigate-month` (-1/+1) |
| **æ˜ ç•«æ¨¡å¼** | åœ–ç‰‡æ­¥é€²ï¼ˆä¸Š/ä¸‹å¼µï¼‰ | æ™¶é€ç™½ `#FFFFFF` | `request-hero-change` |
| **Zen æ¨¡å¼** | Dock éš±è—ï¼ˆä¸å¯è¦‹ï¼‰ | â€” | æ»‘å‹•æ‰‹å‹¢æ›¿ä»£ |

#### 3.4 Dock éŸ¿æ‡‰å¼è¡Œç‚º

```css
/* æ ¸å¿ƒç­–ç•¥ï¼šè¡Œå‹•å„ªå…ˆã€åº•éƒ¨å›ºå®šã€æ°´å¹³ç½®ä¸­ */
.hero-dock {
  position: fixed;
  bottom: var(--safe-bottom);    /* å®‰å…¨å€åŸŸé©é… */
  left: 50%;
  transform: translateX(-50%);   /* å¼·åˆ¶æ°´å¹³ç½®ä¸­ */
  max-width: 500px;              /* æœ€å¤§å¯¬åº¦é™åˆ¶ */
  width: calc(100% - 2rem);      /* å°è¢å¹•æ’æ»¿æ¸›é‚Šè· */
}

/* è¡Œå‹•ç«¯: ç§»é™¤å·¥å…·åˆ—æ–‡å­—ï¼Œç´”åœ–æ¨™é©…å‹• */
@media (max-width: 767px) {
  .dock-btn span:empty + ... { /* è£œå„Ÿå…§é‚Šè· */ }
}
```

### 4. CalendarBoard ç‰ˆé¢é…ç½®

#### 4.1 æ—¥æ›†ç¶²æ ¼çµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CalendarHeader                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  è¾²æ›† æ­£æœˆ                        â”‚  â”‚ (è¾²æ›†æœˆä»½)
â”‚  â”‚  2026 . 02                        â”‚  â”‚ (è¥¿æ›†å¹´æœˆ)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  CalendarGridContainer                  â”‚
â”‚  â”Œâ”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”              â”‚
â”‚  â”‚æ—¥â”‚ä¸€â”‚äºŒâ”‚ä¸‰â”‚å››â”‚äº”â”‚å…­â”‚              â”‚ (æ¼¢å­—é€±é¦–)
â”‚  â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤              â”‚
â”‚  â”‚26â”‚27â”‚28â”‚29â”‚30â”‚31â”‚ 1â”‚              â”‚ (ç°è‰²å‰æœˆ + ç•¶æœˆ)
â”‚  â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤              â”‚
â”‚  â”‚ 2â”‚ 3â”‚ 4â”‚ 5â”‚ 6â”‚ 7â”‚ 8â”‚              â”‚
â”‚  â”‚  â”‚  â”‚  â”‚ç«‹æ˜¥â”‚  â”‚  â”‚  â”‚              â”‚ (ç¯€æ°£é‡‘è‰²æ¨™è¨»)
â”‚  â”œâ”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¼â”€â”€â”¤              â”‚
â”‚  â”‚ ...                    ...â”‚        â”‚
â”‚  â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 4.2 æ—¥æœŸæ ¼ (Day Cell) å…§å®¹ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  25            â”‚   â† è¥¿æ›†æ•¸å­—ï¼ˆå·¦ä¸Šï¼ŒPlayfair Display è¥¯ç·šé«”ï¼‰
â”‚                â”‚
â”‚                â”‚
â”‚       åˆäº”     â”‚   â† è¾²æ›†æ—¥æœŸï¼ˆå³ä¸‹ï¼ŒNoto Serif TCï¼‰
â”‚                â”‚      æˆ–ç¯€æ°£åï¼ˆé‡‘è‰²ï¼‰/ ç¯€æ…¶åï¼ˆç´…è‰²ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¡¯ç¤ºå„ªå…ˆç´š: æ”¿åºœå‡æ—¥(ç´…) > ç¯€æ…¶(ç´…) > ç¯€æ°£(é‡‘) > è¾²æ›†æ—¥(ç°)
```

#### 4.3 æ—¥æ›†åˆ‡æ›å‹•ç•«

```
å‘ä¸‹å€‹æœˆåˆ‡æ› (direction: +1):
  â†’ ç•¶å‰ç¶²æ ¼åŠ å…¥ class: animate-slide-left  (å‘å·¦æ»‘å‡º)
  â†’ æ–°ç¶²æ ¼ç«‹å³æ¸²æŸ“
  â†’ animationend å¾Œç§»é™¤ class

å‘ä¸Šå€‹æœˆåˆ‡æ› (direction: -1):
  â†’ ç•¶å‰ç¶²æ ¼åŠ å…¥ class: animate-slide-right (å‘å³æ»‘å‡º)
  â†’ åŒä¸Š
```

### 5. FloatingPanels ç‰ˆé¢é…ç½®

#### 5.1 é¢æ¿é¡å‹èˆ‡çµæ§‹

```
é¢æ¿: #panelYearMonth (å¹´æœˆé¸æ“‡å™¨)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¹´ä»½é¸æ“‡ (5æ¬„ Ã— 2åˆ—, å…±10å¹´)    â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”         â”‚
â”‚  â”‚2022â”‚2023â”‚2024â”‚2025â”‚2026â”‚       â”‚  â† ç•¶å‰å¹´é«˜äº®
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤         â”‚
â”‚  â”‚2027â”‚2028â”‚2029â”‚2030â”‚2031â”‚       â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜         â”‚
â”‚                                  â”‚
â”‚  æœˆä»½é¸æ“‡ (4æ¬„ Ã— 3åˆ—, å…±12æœˆ)    â”‚
â”‚  â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”             â”‚
â”‚  â”‚ 1 â”‚ 2 â”‚ 3 â”‚ 4 â”‚             â”‚  â† ç•¶å‰æœˆé«˜äº®
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤             â”‚
â”‚  â”‚ 5 â”‚ 6 â”‚ 7 â”‚ 8 â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤             â”‚
â”‚  â”‚ 9 â”‚10 â”‚11 â”‚12 â”‚             â”‚
â”‚  â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é¢æ¿: #panelToday (ä»Šæ—¥è©³æƒ…)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â–  å´é‚Šè£é£¾æ¢                     â”‚
â”‚  æ—¥æœŸ: 2026å¹´02æœˆ17æ—¥              â”‚
â”‚  è¾²æ›†: ä¹™å·³å¹´ æ­£æœˆ å»¿ä¸€            â”‚
â”‚  å¹²æ”¯: ä¹™å·³å¹´ æˆŠå¯…æœˆ åºšåˆæ—¥         â”‚
â”‚  ç”Ÿè‚–: è›‡ ğŸ                      â”‚
â”‚  å»ºé™¤: åŸ· (å°å‡¶)                   â”‚
â”‚  äºŒåå…«å®¿: æ° (åœŸè²‰, å‰) ğŸ·ï¸       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚  å®œ: ç¥­ç¥€ ç¥ˆç¦ é–‹å…‰ ...            â”‚
â”‚  å¿Œ: å‹•åœŸ ç§»å¾™ å…¥å®… ...            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€            â”‚
â”‚  ä»Šæ—¥å‰æ™‚: ...                     â”‚
â”‚  [åˆ†äº«æŒ‰éˆ•]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.2 é¢æ¿å®šä½è¦å‰‡

```css
/* æ‰€æœ‰é¢æ¿çµ±ä¸€å®šä½ç­–ç•¥ */
.floating-panel {
  position: fixed;
  bottom: calc(var(--safe-bottom) + var(--dock-height) + 1rem);
  left: 50%;
  transform: translateX(-50%);         /* å¼·åˆ¶æ°´å¹³ç½®ä¸­ */
  max-width: 500px;
  width: calc(100% - 2rem);
  animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1); /* åº•éƒ¨æ»‘å…¥ */
}
```

#### 5.3 é¢æ¿äº’æ–¥é‚è¼¯

```
Toggle è¦å‰‡:
  toggle-panel('yearMonth') ä¸” activePanel === 'yearMonth'
    â†’ é—œé–‰é¢æ¿, activePanel = null
  
  toggle-panel('yearMonth') ä¸” activePanel === 'today'
    â†’ é—œé–‰ today, é–‹å•Ÿ yearMonth, activePanel = 'yearMonth'
  
  toggle-panel('yearMonth') ä¸” activePanel === null
    â†’ é–‹å•Ÿ yearMonth, activePanel = 'yearMonth'

èƒŒæ™¯é®ç½©åŒæ­¥:
  activePanel !== null â†’ #panelBackOverlay é¡¯ç¤º
  activePanel === null â†’ #panelBackOverlay éš±è—
  
  é»æ“Š #panelBackOverlay â†’ close-panels äº‹ä»¶ â†’ é—œé–‰æ‰€æœ‰é¢æ¿

body[data-active-panel]:
  CSS é¸æ“‡å™¨å¯ç”¨æ­¤å±¬æ€§æ§åˆ¶é¢æ¿ç›¸é—œçš„å…¨åŸŸæ¨£å¼
```

### 6. å³ä¸Šå·¥å…·æŒ‰éˆ•ç¾¤ä½ˆå±€

```
ç”±å³è‡³å·¦æ’åˆ—:
  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”  â”Œâ”€â”€â”€â”
  â”‚ ğŸµâ”‚  â”‚ ğŸ–¼ï¸â”‚  â”‚ â“â”‚
  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜  â””â”€â”€â”€â”˜
   éŸ³æ¨‚    æ²‰æµ¸    FAQ

å®šä½: position: fixed; top: var(--hero-control-top); right: ...
      (è€ƒæ…® safe-area-inset)
```

---

## æŒ‰éˆ•ç‹€æ…‹è½‰ç§»è©³ç´°è¦ç¯„ (Button State Machine â€” Detailed)

### 1. å…¨åŸŸæ¨¡å¼ç‹€æ…‹æ©Ÿ

#### 1.1 ç‹€æ…‹è½‰ç§»åœ–

```mermaid
stateDiagram-v2
    state "Welcome" as W
    state "Calendar" as C
    state "Artwork" as A
    state "Zen" as Z
    state "Note" as N

    [*] --> W : æ‡‰ç”¨å•Ÿå‹•

    W --> C : é»æ“ŠèƒŒæ™¯ / æ—¥æ›†æŒ‰éˆ•
    W --> Z : é–’ç½® 6ç§’ è‡ªå‹•è½‰å ´

    C --> A : é»æ“Šã€Œæ˜ ç•«ã€æŒ‰éˆ• / é»æ“ŠèƒŒæ™¯
    C --> N : é»æ“Šã€Œç­†è¨˜ã€æŒ‰éˆ•

    A --> C : é»æ“Šã€Œæ—¥æ›†ã€æŒ‰éˆ•
    A --> Z : é»æ“ŠèƒŒæ™¯ (requestFullscreen)
    A --> Z : é–’ç½® 15ç§’ è‡ªå‹•è½‰å ´

    Z --> A : é»æ“Šç•«é¢ (exitFullscreen)
    Z --> A : æŒ‰ Esc (fullscreenchange åŒæ­¥)
    Z --> A : æ»‘å‹•æ‰‹å‹¢è§¸ç™¼

    N --> C : é—œé–‰ç­†è¨˜é¢æ¿
```

#### 1.2 åˆæ³•è½‰ç§»è·¯å¾‘è¡¨ (Transition Table)

FSM å¿…é ˆä¾æ“šæ­¤è¡¨é©—è­‰æ¯æ¬¡è½‰æ›çš„åˆæ³•æ€§ã€‚éæ³•è½‰æ›æ‡‰è¢«æ‹’çµ•ä¸¦è¨˜éŒ„ `console.warn`ã€‚

| From ï¼¼ To | Welcome | Calendar | Artwork | Zen | Note |
|------------|---------|----------|---------|-----|------|
| **Welcome** | â€” | âœ… é»æ“ŠèƒŒæ™¯/æŒ‰éˆ• | âŒ | âœ… é–’ç½®6s | âŒ |
| **Calendar** | âŒ | â€” | âœ… æ˜ ç•«æŒ‰éˆ•/èƒŒæ™¯ | âŒ | âœ… ç­†è¨˜æŒ‰éˆ• |
| **Artwork** | âŒ | âœ… æ—¥æ›†æŒ‰éˆ• | â€” | âœ… èƒŒæ™¯/é–’ç½® | âŒ |
| **Zen** | âŒ | âŒ | âœ… é»æ“Š/Esc/æ»‘å‹• | â€” | âŒ |
| **Note** | âŒ | âœ… é—œé–‰é¢æ¿ | âŒ | âŒ | â€” |

**å®ˆè¡›è¦å‰‡ (Guards)**ï¼š
- `Calendar â†’ Artwork`ï¼šå¿…é ˆå…ˆæ¸…é™¤æ‰€æœ‰é–‹å•Ÿçš„é¢æ¿ (`activePanel = null`)
- `Artwork â†’ Zen`ï¼šä¸å¼·åˆ¶ fullscreen æˆåŠŸï¼ˆiOS é™ç´šè™•ç†ï¼‰
- `Welcome â†’ Zen`ï¼šåƒ…é™ IdleManager è‡ªå‹•è§¸ç™¼ï¼Œä¸æ¥å—æ‰‹å‹•è§¸ç™¼
- ä»»ä½•è½‰æ›ï¼šè½‰ç§»é–å•Ÿç”¨æœŸé–“ï¼Œæ‹’çµ•æ–°è«‹æ±‚ï¼ˆæ’å…¥ä½‡åˆ—ï¼‰

#### 1.3 è½‰ç§»ç”Ÿå‘½é€±æœŸ (Transition Lifecycle)

æ¯æ¬¡æ¨¡å¼è½‰æ›å¿…é ˆç¶“æ­·ä»¥ä¸‹å››éšæ®µï¼Œç¢ºä¿ DOM æ›´æ–°çš„åŸå­æ€§èˆ‡ä¸€è‡´æ€§ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Mode Transition Lifecycle                      â”‚
â”‚                                                          â”‚
â”‚  1. beforeExit(from)                                     â”‚
â”‚     â”‚ â–¸ å•Ÿç”¨è½‰ç§»é– (isTransitioning = true)              â”‚
â”‚     â”‚ â–¸ æ¸…ç†ç•¶å‰æ¨¡å¼çš„è¨ˆæ™‚å™¨ (IdleManager.clear)          â”‚
â”‚     â”‚ â–¸ é—œé–‰é¢æ¿ (if needed)                              â”‚
â”‚     â”‚ â–¸ åœæ­¢è¼ªæ’­ (if needed)                              â”‚
â”‚     â–¼                                                    â”‚
â”‚  2. beforeEnter(to)                                      â”‚
â”‚     â”‚ â–¸ è¨ˆç®—æ–°æ¨¡å¼æ‰€éœ€çš„ class é›†åˆ                       â”‚
â”‚     â”‚ â–¸ è¨ˆç®—éœ€è¦ç§»é™¤çš„ class é›†åˆ                         â”‚
â”‚     â”‚ â–¸ æº–å‚™ UI å…ƒä»¶çš„ç›®æ¨™ç‹€æ…‹å¿«ç…§                        â”‚
â”‚     â–¼                                                    â”‚
â”‚  3. performTransition() â€” åœ¨ requestAnimationFrame å…§    â”‚
â”‚     â”‚ â–¸ åŸå­æ›¿æ› body class (å…ˆ add å¾Œ remove)            â”‚
â”‚     â”‚ â–¸ æ‰¹æ¬¡æ›´æ–°æ‰€æœ‰ UI å…ƒä»¶å¯è¦‹æ€§                        â”‚
â”‚     â”‚ â–¸ åŒæ­¥åˆ‡æ›è‰²ç³» (Gold â†” Silver)                     â”‚
â”‚     â”‚ â–¸ æ›´æ–° Dock åŠŸèƒ½æ§½ä½ (.group-calendar â†” .group-image)â”‚
â”‚     â–¼                                                    â”‚
â”‚  4. afterEnter(to)                                       â”‚
â”‚     â”‚ â–¸ å•Ÿå‹•æ–°æ¨¡å¼çš„è¨ˆæ™‚å™¨ (idle/slideshow)                â”‚
â”‚     â”‚ â–¸ è§¸ç™¼ mode-changed äº‹ä»¶é€šçŸ¥                        â”‚
â”‚     â”‚ â–¸ é‡‹æ”¾è½‰ç§»é– (isTransitioning = false)              â”‚
â”‚     â”‚ â–¸ è™•ç†ä½‡åˆ—ä¸­çš„ä¸‹ä¸€å€‹è½‰æ›è«‹æ±‚ (if any)               â”‚
â”‚     â–¼                                                    â”‚
â”‚  Done                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é—œéµè¨­è¨ˆæ±ºç­–**ï¼š

- **åŸå­ Class æ›¿æ›**ï¼š`performTransition()` å…§çš„ class æ“ä½œå¿…é ˆæ˜¯ã€Œå…ˆ add æ–° class â†’ å† remove èˆŠ classã€ï¼Œ**çµ•ä¸èƒ½å…ˆç§»é™¤æ‰€æœ‰ class**ã€‚é€™é¿å…äº†ä¸­é–“å¹€å› æ²’æœ‰ class è€Œå°è‡´ CSS æ¢ä»¶é¸æ“‡å™¨å¤±æ•ˆï¼Œé€ æˆä½ˆå±€é–ƒçˆã€‚

  ```typescript
  // âŒ éŒ¯èª¤ï¼šç•¶å‰å¯¦ä½œ â€” å…ˆæ¸…ç©ºå†æ·»åŠ ï¼Œå°è‡´ 1 å¹€ç„¡ class
  body.classList.remove("initial-welcome", "immersion-mode", "mode-artwork", "note-mode-active");
  body.classList.add(...newClasses);

  // âœ… æ­£ç¢ºï¼šåŸå­æ›¿æ› â€” åœ¨ rAF å…§å…ˆåŠ å¾Œæ¸›
  requestAnimationFrame(() => {
    body.classList.add(...classesToAdd);
    body.classList.remove(...classesToRemove);
  });
  ```

- **è½‰ç§»é– (Transition Lock)**ï¼šé˜²æ­¢é«˜é »æ“ä½œï¼ˆå¦‚å¿«é€Ÿé€£æ“Šæ¨¡å¼æŒ‰éˆ•ï¼‰å°è‡´å¤šæ¬¡è½‰æ›é‡ç–Šã€‚é–å®šæœŸé–“çš„æ–°è«‹æ±‚æ’å…¥ FIFO ä½‡åˆ—ï¼Œç•¶å‰è½‰æ›å®Œæˆå¾Œè‡ªå‹•è™•ç†ä½‡åˆ—é¦–é …ã€‚

  ```typescript
  interface TransitionQueue {
    isTransitioning: boolean;
    queue: AppMode[];
  }
  ```

- **è¨ˆæ™‚å™¨æ¸…ç†æ™‚åº**ï¼š`beforeExit` éšæ®µå¿…é ˆå…ˆæ¸…ç†æ‰€æœ‰è¨ˆæ™‚å™¨ï¼ˆidle/artwork/slideshowï¼‰ï¼Œé¿å…è¨ˆæ™‚å™¨åœ¨è½‰æ›éç¨‹ä¸­è§¸ç™¼å›èª¿å°è‡´ç‹€æ…‹æ±¡æŸ“ã€‚

### 1.5 Note ç­†è¨˜æ•¸æ“šèˆ‡ UI é‚è¼¯ (Note Feature Logic)

ç­†è¨˜åŠŸèƒ½æ¡ç”¨ã€Œå…§å®¹ç‚ºé‡ã€çš„è¨­è¨ˆï¼Œæ•¸æ“šå„²å­˜æ–¼ IndexedDB ä»¥ç¢ºä¿éš±ç§èˆ‡é›¢ç·šå¯ç”¨æ€§ã€‚

#### 1.5.1 æ•¸æ“šçµæ§‹ (Note Schema)

```typescript
interface UserNote {
  id: string;               // UUID æˆ–æ—¥æœŸ+åºè™Ÿ
  date: string;             // YYYY-MM-DD
  title: string;            // ç­†è¨˜æ¨™é¡Œ
  content: string;          // ç­†è¨˜æ­£æ–‡
  category?: string;        // åˆ†é¡æ¨™ç±¤
  colorTheme?: string;      // é¸ç”¨çš„åº•ç´™ä¸»é¡Œ (å¦‚ WarmPaper, DarkGlass)
  timestamp: number;        // å»ºç«‹/ä¿®æ”¹æ™‚é–“
}
```

#### 1.5.2 æ¨¡å¼è½‰æ› (Transition to Note)

ç•¶ä½¿ç”¨è€…åœ¨ä»Šæ—¥é¢æ¿ä¸­é»æ“Šã€Œç­†è¨˜ã€æŒ‰éˆ•æ™‚ï¼š
1. `AppEventOrchestrator` ç™¼é€ `transition-mode: { to: 'note' }`ã€‚
2. `ModeHandler` ç¢ºä¿ç•¶å‰ `activePanel` ç‚º `today`ã€‚
3. `body` åŠ å…¥ `note-mode-active`ã€‚
4. ä»Šæ—¥é¢æ¿æ“´å±•ï¼Œéš±è—è¾²æ›†å®œå¿Œï¼Œé¡¯ç¤ºç­†è¨˜ç·¨è¼¯å€ã€‚

#### 1.5.3 æŒä¹…åŒ–èˆ‡åŒæ­¥

*   **è‡ªå‹•å„²å­˜**ï¼šæ¯ 2 ç§’ç„¡è¼¸å…¥æˆ–å¤±å»ç„¦é» (blur) æ™‚è‡ªå‹•å­˜å…¥ IndexedDBã€‚
*   **å°èˆªä¿è­·**ï¼šè‹¥å…§å®¹æœ‰è®Šæ›´ä¸”å°šæœªå®Œæˆè‡ªå‹•å„²å­˜ï¼Œé˜»æ–·æ¨¡å¼è½‰æ›è«‹æ±‚ä¸¦æç¤ºã€‚

#### 1.5.4 åŒ¯å‡ºé‚è¼¯

*   æ ¼å¼æ”¯æŒï¼š`LunarNote_YYYYMM.json` (æ•´æœˆå‚™ä»½) æˆ– `DailyNote_YYYYMMDD.txt` (å–®æ—¥åŒ¯å‡º)ã€‚

---

#### 1.4 IdleManager é‡æ§‹æ–¹æ¡ˆ

**ç•¶å‰å•é¡Œ**ï¼š
- `idleTimer`ï¼ˆå…¨åŸŸé–’ç½®â†’Zenï¼‰èˆ‡ `artworkTimer`ï¼ˆæ˜ ç•«è‡ªå‹•æ›åœ–ï¼‰å…±äº« `reset()` æ–¹æ³•ï¼Œå°è‡´éé æœŸçš„è¨ˆæ™‚å™¨é‡å•Ÿ
- `reset()` è¢«éå¤šä¾†æºå‘¼å«ï¼ˆå…¨åŸŸ mousedown/touchstart/keypress + å„ Handler é¡¯å¼å‘¼å«ï¼‰ï¼Œè¡Œç‚ºé›£ä»¥è¿½è¹¤
- æ­¡è¿æ¨¡å¼çš„ 6s èˆ‡æ˜ ç•«æ¨¡å¼çš„ 15s é–’ç½®è¶…æ™‚æ··ç”¨åŒä¸€å€‹ `idleTimer`ï¼Œèªç¾©ä¸æ¸…

**é‡æ§‹æ–¹æ¡ˆ**ï¼šå°‡ IdleManager æ‹†åˆ†ç‚ºä¸‰å€‹ç¨ç«‹çš„è¨ˆæ™‚å™¨åŸŸï¼Œæ¯å€‹åŸŸæœ‰æ˜ç¢ºçš„å•Ÿå‹•æ¢ä»¶èˆ‡è§¸ç™¼è¡Œç‚ºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            IdleManager (Refactored)            â”‚
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ welcomeTimer     â”‚  â”‚ zenTimer          â”‚    â”‚
â”‚  â”‚ è¶…æ™‚: 6000ms     â”‚  â”‚ è¶…æ™‚: 15000ms     â”‚    â”‚
â”‚  â”‚ è§¸ç™¼: â†’Zen       â”‚  â”‚ è§¸ç™¼: â†’Zen        â”‚    â”‚
â”‚  â”‚ æ´»èº: Welcomeæ¨¡å¼ â”‚  â”‚ æ´»èº: Artworkæ¨¡å¼  â”‚    â”‚
â”‚  â”‚ è¿½è¹¤: ç„¡mousemoveâ”‚  â”‚ è¿½è¹¤: å«mousemove â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ artworkSlideTimer                    â”‚      â”‚
â”‚  â”‚ è¶…æ™‚: 5000ms (å¾ªç’°)                  â”‚      â”‚
â”‚  â”‚ è§¸ç™¼: artwork-idle-slide             â”‚      â”‚
â”‚  â”‚ æ´»èº: Artworkæ¨¡å¼                    â”‚      â”‚
â”‚  â”‚ èˆ‡ zenTimer ç¨ç«‹é‹ä½œ                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                â”‚
â”‚  API:                                          â”‚
â”‚  â–¸ activateForMode(mode: AppMode): void        â”‚
â”‚  â–¸ deactivateAll(): void                       â”‚
â”‚  â–¸ resetInteraction(): void (åƒ…é‡ç½®é–’ç½®è¨ˆæ™‚å™¨)  â”‚
â”‚  â–¸ pauseSlideTimer(): void                     â”‚
â”‚  â–¸ resumeSlideTimer(): void                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡æ§‹å¾Œæµç¨‹**ï¼š
- é€²å…¥ Welcome â†’ `activateForMode('welcome')` â†’ å•Ÿå‹• `welcomeTimer`(6s)
- é€²å…¥ Artwork â†’ `activateForMode('artwork')` â†’ å•Ÿå‹• `zenTimer`(15s) + `artworkSlideTimer`(5s å¾ªç’°)
- ä½¿ç”¨è€…äº’å‹• â†’ `resetInteraction()` â†’ åƒ…é‡ç½® `welcomeTimer` æˆ– `zenTimer`ï¼ˆä¾ç•¶å‰æ´»èºè¨ˆæ™‚å™¨ï¼‰ï¼Œ**ä¸å½±éŸ¿** `artworkSlideTimer`
- é›¢é–‹ä»»ä½•æ¨¡å¼ â†’ `deactivateAll()` â†’ æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨

**ç™¼ç¾ 2.1ï¼šWelcome é–’ç½®è¶…æ™‚ä½¿ç”¨éŒ¯èª¤å€¼ (Critical)**

**æª”æ¡ˆ**ï¼š`src/scripts/hero/idleManager.ts` â€” å»ºæ§‹å­

**å•é¡Œ**ï¼š`HeroIdleManager` å»ºæ§‹å­é è¨­ `IDLE_TIMEOUT = 15000`ï¼Œä½†è¦æ ¼è¦æ±‚ Welcome æ¨¡å¼é–’ç½® 6 ç§’é€²å…¥ Zenã€‚ç›®å‰ç¨‹å¼ç¢¼ä¸­ Welcome èˆ‡ Artwork å…±ç”¨åŒä¸€å€‹ `IDLE_TIMEOUT`ï¼ˆ15sï¼‰ï¼Œå°è‡´ Welcome æ¨¡å¼å¯¦éš›é–’ç½® 15 ç§’æ‰è§¸ç™¼â€”â€”é è¶…è¦æ ¼å®šç¾©çš„ 6 ç§’ã€‚

**æ ¹å› **ï¼šå–®ä¸€è¨ˆæ™‚å™¨ + å–®ä¸€è¶…æ™‚å€¼ç„¡æ³•è¡¨é”å…©ç¨®æ¨¡å¼å„è‡ªçš„é–’ç½®èªç¾©ã€‚

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šä¸‰åŸŸè¨ˆæ™‚å™¨é‡æ§‹å¾Œï¼Œ`welcomeTimer` ä½¿ç”¨ç¨ç«‹çš„ `WELCOME_IDLE_TIMEOUT = 6000`ï¼Œ`zenTimer` ä½¿ç”¨ `ZEN_IDLE_TIMEOUT = 15000`ï¼Œå¾¹åº•è§£è€¦ã€‚

### 2. AppMode åˆ‡æ›æ™‚çš„ Body Class æ˜ å°„

| AppMode | body.classList æ“ä½œ | DOM æ•ˆæœ |
|---------|---------------------|----------|
| `welcome` | add: `initial-welcome`, `immersion-mode` | éš±è— Dock/Gridï¼Œé¡¯ç¤ºæ­¡è¿å¡ç‰‡ |
| `calendar` | remove: all above | é¡¯ç¤ºæ—¥æ›†ç¶²æ ¼ã€Dock (é‡‘è‰²ç³») |
| `artwork` | add: `immersion-mode`, `mode-artwork` | éš±è—ç¶²æ ¼ï¼ŒDock (éŠ€è‰²ç³»)ï¼Œé¡¯ç¤ºè—å»Šé¸å–® |
| `zen` | add: `immersion-mode`; remove: `mode-artwork` | éš±è—å…¨éƒ¨ UIï¼Œå…¨è¢å¹• |
| `note` | add: `note-mode-active` | é¡¯ç¤ºç­†è¨˜é¢æ¿ |

#### 2.1 åŸå­ Class æ›¿æ›è¡¨ (Atomic Class Swap Table)

ä»¥ä¸‹è¡¨æ ¼ç²¾ç¢ºå®šç¾©æ¯å€‹è½‰æ›è·¯å¾‘ä¸­éœ€è¦ add/remove çš„ classï¼Œç¢ºä¿åœ¨ `requestAnimationFrame` å…§ä»¥ã€Œå…ˆ add â†’ å¾Œ removeã€çš„é †åºä¸€æ¬¡æ€§å®Œæˆï¼š

| è½‰æ›è·¯å¾‘ | classList.add | classList.remove | å‚™è¨» |
|----------|-------------|-----------------|------|
| `Welcome â†’ Calendar` | _(ç„¡)_ | `initial-welcome`, `immersion-mode` | æ¢å¾©åŸºç¤ä½ˆå±€ |
| `Welcome â†’ Zen` | _(ç„¡)_ | `initial-welcome` | ä¿ç•™ `immersion-mode` |
| `Calendar â†’ Artwork` | `immersion-mode`, `mode-artwork` | _(ç„¡)_ | é€²å…¥æ²‰æµ¸æ˜ ç•« |
| `Calendar â†’ Note` | `note-mode-active` | _(ç„¡)_ | ç–ŠåŠ ç­†è¨˜å±¤ |
| `Artwork â†’ Calendar` | _(ç„¡)_ | `immersion-mode`, `mode-artwork` | é€€å‡ºæ²‰æµ¸ |
| `Artwork â†’ Zen` | _(ç„¡)_ | `mode-artwork` | ä¿ç•™ `immersion-mode` |
| `Zen â†’ Artwork` | `mode-artwork` | _(ç„¡)_ | ä¿ç•™ `immersion-mode` |
| `Note â†’ Calendar` | _(ç„¡)_ | `note-mode-active` | æ¢å¾©æ—¥æ›† |

**å¯¦ä½œè¦é»**ï¼š
```typescript
// stateManager.setMode(to) çš„ç†æƒ³å¯¦ä½œ
public setMode(to: AppMode): void {
  const from = this.mode;
  this.mode = to;

  const swap = TRANSITION_CLASS_MAP[`${from}->${to}`];
  if (!swap) {
    console.warn(`[FSM] Invalid transition: ${from} â†’ ${to}`);
    return;
  }

  requestAnimationFrame(() => {
    if (swap.add.length) document.body.classList.add(...swap.add);
    if (swap.remove.length) document.body.classList.remove(...swap.remove);
  });
}
```

### 3. Dock æŒ‰éˆ•ç‹€æ…‹è½‰ç§»è¡¨

#### 3.1 `btnPrevHero` / `btnNextHero` (æ­¥é€²éµ < >)

```
ç‹€æ…‹ A: æ—¥æ›†æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ è‰²ç³»: é‡‘  â”‚  åŠŸèƒ½: navigate-month(-1/+1)
  â”‚ å¯è¦‹: æ˜¯  â”‚  å›é¥‹: scale(0.96) on :active
  â”‚ åœ–æ¨™: â—€â–¶ â”‚  
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åˆ‡æ›è‡³ã€Œæ˜ ç•«ã€
       â–¼
ç‹€æ…‹ B: æ˜ ç•«æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ è‰²ç³»: éŠ€  â”‚  åŠŸèƒ½: request-hero-change (prev/next)
  â”‚ å¯è¦‹: æ˜¯  â”‚  å›é¥‹: scale(0.96) on :active
  â”‚ åœ–æ¨™: â—€â–¶ â”‚  
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ åˆ‡æ›è‡³ã€ŒZenã€
       â–¼
ç‹€æ…‹ C: Zen æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¯è¦‹: å¦  â”‚  Dock æ•´é«”éš±è—
  â”‚ æ›¿ä»£: æ»‘å‹•â”‚  è§¸æ§æ‰‹å‹¢æ›¿ä»£ < > åŠŸèƒ½
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2 `btnChangeImage` (æ˜ ç•«å…¥å£)

```
ç‹€æ…‹ A: æ—¥æ›†æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡¯ç¤ºæ–‡å­—: æ˜ ç•«â”‚  åŠŸèƒ½: transition-mode â†’ 'artwork'
  â”‚ active: false â”‚
  â”‚ è‰²ç³»: é‡‘      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ é»æ“Š
       â–¼
ç‹€æ…‹ B: æ˜ ç•«æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡¯ç¤ºæ–‡å­—: æ˜ ç•«â”‚  åŠŸèƒ½: (å·²åœ¨æ˜ ç•«æ¨¡å¼, ä¸åŸ·è¡Œ)
  â”‚ active: true  â”‚  â†’ é«˜äº®ç‹€æ…‹ (éŠ€ç™½åº• + ç™½å­—)
  â”‚ è‰²ç³»: éŠ€      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3 `btnDay` (æ—¥æ›†å…¥å£)

```
ç‹€æ…‹ A: æ˜ ç•«æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡¯ç¤ºæ–‡å­—: æ—¥æ›†â”‚  åŠŸèƒ½: transition-mode â†’ 'calendar'
  â”‚ active: false â”‚
  â”‚ è‰²ç³»: éŠ€      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ é»æ“Š
       â–¼
ç‹€æ…‹ B: æ—¥æ›†æ¨¡å¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡¯ç¤ºæ–‡å­—: æ—¥æ›†â”‚  åŠŸèƒ½: toggle-grid (é–‹/é—œæ—¥æ›†ç¶²æ ¼)
  â”‚ active: true  â”‚  â†’ é«˜äº®ç‹€æ…‹ (æš–æ›œåº• + é‡‘å­—)
  â”‚ è‰²ç³»: é‡‘      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.4 `btnYearMonth` (å¹´æœˆé¸æ“‡å™¨)

```
åˆå§‹: æ—¥æ›†æ¨¡å¼ / é¢æ¿é—œé–‰
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ active: false â”‚  åŠŸèƒ½: toggle-panel('yearMonth')
  â”‚ è‰²ç³»: é‡‘      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ é»æ“Š
       â–¼
å¹´æœˆé¢æ¿é–‹å•Ÿ:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ active: true  â”‚  â†’ body[data-active-panel="yearMonth"]
  â”‚ è‰²ç³»: é‡‘      â”‚  é¢æ¿åº•éƒ¨æ»‘å…¥ + é®ç½©å‡ºç¾
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ å†æ¬¡é»æ“Š / é»æ“Šé®ç½©
       â–¼
å¹´æœˆé¢æ¿é—œé–‰:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ active: false â”‚  â†’ body[data-active-panel=""]
  â”‚ è‰²ç³»: é‡‘      â”‚  é¢æ¿æ»‘å‡º + é®ç½©æ¶ˆå¤±
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.5 è—å»Šé¸å–® (ä¸­é–“æ§½ä½)

```
æ—¥æ›†æ¨¡å¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¯è¦‹: å¦      â”‚  .gallery-control-wrapper { display: none }
  â”‚ æ›¿ä»£: å¹´æœˆéˆ•  â”‚  .group-calendar { display: flex }
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ˜ ç•«æ¨¡å¼:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¯è¦‹: æ˜¯      â”‚  .gallery-control-wrapper { display: flex }
  â”‚ åŠŸèƒ½é¸é …:     â”‚
  â”‚  Â· Default   â”‚  å­£ç¯€åœ–ç‰‡æ¸…å–®
  â”‚  Â· Custom    â”‚  è‡ªé¸åœ–ç‰‡ (IndexedDB)
  â”‚  Â· Hybrid    â”‚  æ··åˆæ¨¡å¼
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.6 å³ä¸Šè§’å·¥å…·æŒ‰éˆ•ç¾¤

```
ğŸµ éŸ³æ¨‚æŒ‰éˆ•:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ éœæ­¢åœ–æ¨™  â”‚â”€â”€â”€â”€â–¶â”‚ å‘¼å¸æ³¢ç´‹  â”‚  (éŸ³æ¨‚æ’­æ”¾ä¸­)
  â”‚ å¯è¦‹: æ˜¯  â”‚     â”‚ å¯è¦‹: æ˜¯  â”‚
  â”‚ è‰²ç³»: éš¨æ¨¡â”‚     â”‚ è‰²ç³»: éš¨æ¨¡â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ–¼ï¸ æ²‰æµ¸æŒ‰éˆ•:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¯è¦‹: æ˜¯  â”‚â”€â”€â”€â”€â–¶â”‚ Zen æ¨¡å¼  â”‚  â†’ requestFullscreen()
  â”‚ åŠŸèƒ½: Zen â”‚     â”‚ UI å…¨éš±è— â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â“ FAQ æŒ‰éˆ•:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ active:å¦ â”‚â”€â”€â”€â”€â–¶â”‚ active:æ˜¯ â”‚  â†’ FAQ é¢æ¿é–‹å•Ÿ
  â”‚ å¯è¦‹: æ˜¯  â”‚     â”‚ é¢æ¿é¡¯ç¤º  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. å…ƒä»¶å¯è¦‹æ€§çŸ©é™£ (Visibility Matrix)

| å…ƒä»¶ | Welcome | Calendar | Artwork | Zen | Note |
|------|---------|----------|---------|-----|------|
| **HeroBackground** | âœ… | âœ… | âœ… | âœ… | âœ… |
| **WelcomeOverlay** | âœ… | âŒ | âŒ | âŒ | âŒ |
| **HeroHeader** | âŒ | âœ… | âœ… | âŒ | è¦–ä¸Šä¸‹æ–‡ |
| **HeroDock** | âŒ | âœ… | âœ… | âŒ | è¦–ä¸Šä¸‹æ–‡ |
| **CalendarBoard** | âŒ | âœ… | âŒ | âŒ | âŒ |
| **FloatingPanels** | ä»Šæ—¥é¢æ¿ | å¯åˆ‡æ› | âŒ | âŒ | âŒ |
| **PanelBackOverlay** | âŒ | éœ€è¦æ™‚ | âŒ | âŒ | âŒ |
| **å³ä¸Šå·¥å…·æŒ‰éˆ•** | âŒ | éƒ¨åˆ† | âœ… | âŒ | âŒ |
| **FAQ é¢æ¿** | âŒ | âŒ | âœ… | âŒ | âŒ |
| **ç­†è¨˜é¢æ¿** | âŒ | âŒ | âŒ | âŒ | âœ… |
| **.group-calendar** | âŒ | âœ… | âŒ | âŒ | âŒ |
| **.group-image** | âŒ | âŒ | âœ… | âŒ | âŒ |

CSS å¯¦ä½œç­–ç•¥ï¼šé€é body class (`initial-welcome`, `immersion-mode`, `mode-artwork`, `note-mode-active`) é…åˆå¾Œä»£é¸æ“‡å™¨æ§åˆ¶å¯è¦‹æ€§ï¼š

```css
body.initial-welcome .hero-dock,
body.initial-welcome .calendar-section { display: none; }

body.immersion-mode .calendar-section { display: none; }
body.immersion-mode:not(.mode-artwork) .hero-dock { display: none; }

body.mode-artwork .group-calendar { display: none; }
body.mode-artwork .group-image { display: flex; }
body:not(.mode-artwork) .group-image { display: none; }
```

### 5. è‰²ç³»åŒæ­¥è½‰ç§»è¡¨

| è§¸ç™¼ | å‰è‰²ç³» | å¾Œè‰²ç³» | å½±éŸ¿å…ƒä»¶ |
|------|--------|--------|----------|
| Calendar â†’ Artwork | é¦™æª³é‡‘ | æ¥µåœ°ç´”éŠ€ | Dock æ¡†ç·šã€æ­¥é€²éµã€åˆ†éš”ç·šã€é«˜äº®æŒ‰éˆ•ã€éŸ³æ¨‚æ³¢ç´‹ |
| Artwork â†’ Calendar | æ¥µåœ°ç´”éŠ€ | é¦™æª³é‡‘ | åŒä¸Š |
| Any â†’ Zen | ä»»æ„ | ç„¡ (UI éš±è—) | å…¨éƒ¨éš±è— |
| Zen â†’ Artwork | ç„¡ | æ¥µåœ°ç´”éŠ€ | Dock é‡æ–°é¡¯ç¤ºç‚ºéŠ€è‰²ç³» |

| è‰²å½©å±¬æ€§ | æ—¥æ›†æ¨¡å¼ (Gold) | æ˜ ç•«æ¨¡å¼ (Silver) |
|----------|----------------|------------------|
| åŸºèª¿è‰² | `rgba(45,42,38,0.6)` | `rgba(15,15,25,0.82)` |
| å¼·èª¿è‰² | `#D4AF37` | `#FFFFFF` |
| å…‰æšˆ | `rgba(212,175,55,0.15)` | `rgba(255,255,255,0.1)` |
| æ¡†ç·š | é‡‘è‰²åŠé€æ˜ 20% | éŠ€ç™½åŠé€æ˜ 18% |
| åˆ†éš”ç·š | é‡‘è‰²å‚ç›´æ¼¸å±¤ | éŠ€ç™½è‰²å‚ç›´æ¼¸å±¤ |

### 6. è½‰æ›å‰¯ä½œç”¨æ¸…å–® (Transition Side Effects Matrix)

ä»¥ä¸‹çŸ©é™£å®šç¾©æ¯å€‹åˆæ³•è½‰æ›è·¯å¾‘ä¸­ï¼Œ**é™¤äº† body class ä»¥å¤–**çš„æ‰€æœ‰å‰¯ä½œç”¨ã€‚é€™äº›å‰¯ä½œç”¨å¿…é ˆåœ¨ç”Ÿå‘½é€±æœŸçš„æ­£ç¢ºéšæ®µåŸ·è¡Œã€‚

| è½‰æ›è·¯å¾‘ | beforeExit (Phase 1) | beforeEnter (Phase 2) | performTransition (Phase 3) | afterEnter (Phase 4) |
|----------|---------------------|----------------------|---------------------------|---------------------|
| **Welcome â†’ Calendar** | `idleManager.deactivateAll()` | æº–å‚™ grid é¡¯ç¤ºç‹€æ…‹ | åŸå­ class æ›¿æ› + Dock é¡¯ç¤º (é‡‘è‰²) + CalendarBoard é¡¯ç¤º | `slideshowManager.stop()` + ç™¼é€ `mode-changed` |
| **Welcome â†’ Zen** | `idleManager.deactivateAll()` | â€” | åŸå­ class æ›¿æ› + å…¨ UI éš±è— | `slideshowManager.start(non-artwork)` + ç™¼é€ `mode-changed` |
| **Calendar â†’ Artwork** | `close-panels` + `idleManager.deactivateAll()` | æº–å‚™ Dock éŠ€è‰²ç³» + Gallery é¡¯ç¤º | åŸå­ class æ›¿æ› + `.group-calendar` éš±è— + `.group-image` é¡¯ç¤º + CalendarBoard éš±è— | `idleManager.activateForMode('artwork')` + ç™¼é€ `mode-changed` |
| **Calendar â†’ Note** | `idleManager.deactivateAll()` | â€” | åŸå­ class æ›¿æ› + ç­†è¨˜é¢æ¿é¡¯ç¤º | ç™¼é€ `mode-changed` |
| **Artwork â†’ Calendar** | `idleManager.deactivateAll()` + `slideshowManager.stop()` | æº–å‚™ Dock é‡‘è‰²ç³» + CalendarBoard | åŸå­ class æ›¿æ› + `.group-image` éš±è— + `.group-calendar` é¡¯ç¤º + CalendarBoard é¡¯ç¤º | `close-panels({showGrid: true})` + ç™¼é€ `mode-changed` |
| **Artwork â†’ Zen** | `idleManager.deactivateAll()` | æº–å‚™ fullscreen request | åŸå­ class æ›¿æ› + Dock/Header éš±è— | `requestFullscreen()` (å¯å¤±æ•—) + `slideshowManager.start(non-artwork)` + é¡¯ç¤º Zen Hint (é¦–æ¬¡) + ç™¼é€ `mode-changed` |
| **Zen â†’ Artwork** | `slideshowManager.stop()` | æº–å‚™ Dock éŠ€è‰²ç³» + Gallery | åŸå­ class æ›¿æ› + Dock/Header é‡æ–°é¡¯ç¤º | `exitFullscreen()` (å¯å¤±æ•—) + `idleManager.activateForMode('artwork')` + ç™¼é€ `mode-changed` |
| **Note â†’ Calendar** | â€” | æº–å‚™ CalendarBoard é¡¯ç¤º | åŸå­ class æ›¿æ› + ç­†è¨˜é¢æ¿éš±è— | ç™¼é€ `mode-changed` |

### 7. Fullscreen é™ç´šç­–ç•¥ (Fullscreen Degradation)

```
Artwork â†’ Zen é€²å…¥æµç¨‹:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. performTransition(): åŸå­ class æ›¿æ›   â”‚
  â”‚    â†’ body: immersion-mode (ç„¡ mode-artwork)â”‚
  â”‚    â†’ Dock/Header éš±è—                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2. afterEnter(): å˜—è©¦å…¨è¢å¹•               â”‚
  â”‚    â”œâ”€ æˆåŠŸ: document.fullscreenElement âœ…  â”‚
  â”‚    â””â”€ å¤±æ•—: è¨˜éŒ„ warnï¼ŒZen æ¨¡å¼ä»ç”Ÿæ•ˆ     â”‚
  â”‚         â†’ UI å·²éš±è—ï¼Œä½¿ç”¨è€…ç„¡æ„Ÿå·®ç•°        â”‚
  â”‚         â†’ æ»‘å‹•æ‰‹å‹¢ä»å¯æ­£å¸¸æ“ä½œ             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Zen â†’ Artwork é€€å‡ºæµç¨‹:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ 1. performTransition(): åŸå­ class æ›¿æ›   â”‚
  â”‚    â†’ body: immersion-mode + mode-artwork  â”‚
  â”‚    â†’ Dock/Header é‡æ–°é¡¯ç¤º                â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ 2. afterEnter(): å˜—è©¦é€€å‡ºå…¨è¢å¹•           â”‚
  â”‚    â”œâ”€ document.fullscreenElement å­˜åœ¨:     â”‚
  â”‚    â”‚   document.exitFullscreen()           â”‚
  â”‚    â””â”€ ä¸å­˜åœ¨: è·³éï¼ˆå·²ä¸åœ¨å…¨è¢å¹•ï¼‰         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

fullscreenchange äº‹ä»¶åŒæ­¥:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ç›£è½ document.fullscreenchange            â”‚
  â”‚ è‹¥ !document.fullscreenElement            â”‚
  â”‚   ä¸” mode === 'zen'                       â”‚
  â”‚   â†’ è‡ªå‹• transitionMode('artwork')        â”‚
  â”‚   ï¼ˆç”¨ transition lifecycle è™•ç†ï¼Œéè£¸åˆ‡ï¼‰ â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8. Fullscreen ç”Ÿå‘½é€±æœŸæ•´åˆæ–¹æ¡ˆ (Fullscreen Lifecycle Consolidation)

**ç•¶å‰å•é¡Œ**ï¼š

å…¨è¢å¹•é€²å…¥/é€€å‡ºé‚è¼¯æ•£å¸ƒåœ¨å¤šè™•ï¼Œé•åã€Œæ¨¡å¼è½‰æ›çµ±ä¸€å…¥å£ã€åŸå‰‡ï¼š

1. `uiManager.bindBackgroundClick()` â€” é»æ“ŠèƒŒæ™¯æ™‚ç›´æ¥å‘¼å« `toggleFullscreen(true/false)`
2. `uiManager.bindBackgroundClick()` â€” ç›£è½ `fullscreenchange` åšç‹€æ…‹åŒæ­¥
3. `modeHandler.applyModeSideEffects()` â€” **ä¸å«** fullscreen é‚è¼¯

**å½±éŸ¿**ï¼š
- `transition-mode` äº‹ä»¶èˆ‡ `toggleFullscreen()` çš„åŸ·è¡Œé †åºä¸ä¿è­‰â€”â€”å¯èƒ½å…ˆé€²å…¥ Zen class ä½† fullscreen å°šæœªå•Ÿå‹•
- `fullscreenchange` listener ç›´æ¥ dispatch `transition-mode`ï¼Œä½†æœªç¶“è½‰ç§»é–ï¼ˆè‹¥å·²å¼•å…¥å‰‡æœƒè¡çªï¼‰
- Fullscreen å¤±æ•—æ™‚çš„é™ç´šé‚è¼¯ç„¡æ³•åœ¨è½‰æ›ç”Ÿå‘½é€±æœŸä¸­çµ±ä¸€è™•ç†

**é‡æ§‹æ–¹æ¡ˆ**ï¼šå°‡ fullscreen æ“ä½œç´å…¥å››éšæ®µè½‰æ›ç”Ÿå‘½é€±æœŸçš„ `afterEnter` éšæ®µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡æ§‹å‰ (æ•£è½å¼)                                     â”‚
â”‚                                                    â”‚
â”‚ bindBackgroundClick:                               â”‚
â”‚   dispatch("transition-mode", { to: "zen" })       â”‚
â”‚   toggleFullscreen(true)  â† ç¨ç«‹å‘¼å«ï¼Œæ™‚åºä¸ä¿è­‰    â”‚
â”‚                                                    â”‚
â”‚ applyModeSideEffects("artwork" â†’ "zen"):           â”‚
â”‚   â†’ ä¸å« fullscreen é‚è¼¯                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é‡æ§‹å¾Œ (ç”Ÿå‘½é€±æœŸæ•´åˆ)                               â”‚
â”‚                                                    â”‚
â”‚ bindBackgroundClick:                               â”‚
â”‚   dispatch("transition-mode", { to: "zen" })       â”‚
â”‚   â† ä¸å†ç›´æ¥å‘¼å« toggleFullscreen                   â”‚
â”‚                                                    â”‚
â”‚ Transition Lifecycle:                              â”‚
â”‚   beforeExit("artwork"):                           â”‚
â”‚     â†’ clear timers                                 â”‚
â”‚   performTransition():                             â”‚
â”‚     â†’ rAF: add/remove classes                      â”‚
â”‚   afterEnter("zen"):                               â”‚
â”‚     â†’ requestFullscreen() â† åœ¨æ­¤çµ±ä¸€è™•ç†            â”‚
â”‚     â†’ .catch() â†’ console.warn (é™ç´š)               â”‚
â”‚                                                    â”‚
â”‚ fullscreenchange listener:                         â”‚
â”‚   â†’ æª¢æŸ¥è½‰ç§»é– isTransitioning                     â”‚
â”‚   â†’ è‹¥é–å®šä¸­ï¼Œæ’å…¥ä½‡åˆ—                              â”‚
â”‚   â†’ è‹¥æœªé–å®šï¼Œdispatch transition-mode              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**fullscreenchange äº‹ä»¶å®ˆè¡›**ï¼š

```typescript
document.addEventListener("fullscreenchange", () => {
  if (document.fullscreenElement) return; // é€²å…¥å…¨è¢å¹•ä¸éœ€è™•ç†
  if (stateManager.getMode() !== "zen") return; // ä¸åœ¨ Zen æ¨¡å¼ä¸è™•ç†
  
  // é€éæ¨™æº–è½‰æ›è·¯å¾‘é€€å‡ºï¼Œç¶“éè½‰ç§»é–ä¿è­·
  window.dispatchEvent(
    new CustomEvent("transition-mode", { detail: { to: "artwork" } })
  );
});
```

### 9. toggle-grid äº‹ä»¶èªç¾©é‡æ–°å®šç¾©

**ç•¶å‰å•é¡Œ**ï¼š

`toggle-grid` äº‹ä»¶åç¨±æš—ç¤ºã€Œåˆ‡æ›æ—¥æ›†ç¶²æ ¼é¡¯ç¤º/éš±è—ã€ï¼Œä½†å¯¦éš›ç¨‹å¼ç¢¼ä¸­ (`eventOrchestrator.ts`) è¢«é‡è¼‰ç‚ºæ¨¡å¼åˆ‡æ›è§¸ç™¼å™¨ï¼š

```typescript
// ç¾è¡Œç¨‹å¼ç¢¼ â€” toggle-grid handler
if (mode === "artwork" || mode === "zen" || mode === "welcome") {
    dispatch("transition-mode", { to: "calendar" });  // æ¨¡å¼åˆ‡æ›ï¼
    return;
}
if (mode === "calendar") {
    dispatch("transition-mode", { to: "artwork" });    // æ¨¡å¼åˆ‡æ›ï¼
    return;
}
// åƒ…åœ¨æ¥µå°‘æ•¸æƒ…æ³ä¸‹æ‰åŸ·è¡ŒçœŸæ­£çš„ grid toggle
```

**å½±éŸ¿**ï¼š
- äº‹ä»¶èªç¾©èˆ‡å¯¦éš›è¡Œç‚ºä¸ç¬¦ï¼Œé•åæ†²ç«  Â§VI å‘½ååŸå‰‡
- æ—¥æ›†æŒ‰éˆ• (`btnDay`) çš„åŠŸèƒ½èªç¾©æ··äº‚â€”â€”æœ‰æ™‚æ˜¯ mode toggleï¼Œæœ‰æ™‚æ˜¯ grid toggle
- æ–°é–‹ç™¼è€…é›£ä»¥ç†è§£äº‹ä»¶æµ

**é‡æ§‹æ–¹æ¡ˆ**ï¼š

| å ´æ™¯ | è§¸ç™¼ä¾†æº | ç•¶å‰äº‹ä»¶ | é‡æ§‹å¾Œäº‹ä»¶ |
|------|---------|---------|-----------|
| Calendar â†’ Artwork | `btnDay` (æ˜ ç•«æŒ‰éˆ•) é»æ“Š | `toggle-grid` | `transition-mode { to: "artwork" }` |
| Artwork â†’ Calendar | `btnDay` (æ—¥æ›†æŒ‰éˆ•) é»æ“Š | `toggle-grid` | `transition-mode { to: "calendar" }` |
| é¡¯ç¤º/éš±è—æ—¥æ›†ç¶²æ ¼ | é¢æ¿é—œé–‰æ™‚ | `toggle-grid` | `toggle-grid-view { show: true }` |

è®“ `toggle-grid` å›æ­¸ç´”ç²¹çš„ç¶²æ ¼åˆ‡æ›èªç¾©ï¼Œæ¨¡å¼è½‰æ›ç”±æŒ‰éˆ• handler ç›´æ¥ dispatch `transition-mode`ã€‚

### 10. CSS å‹•ç•«èˆ‡ JS è½‰æ›å”èª¿æ©Ÿåˆ¶

**å•é¡Œ**ï¼šJS åœ¨ `performTransition()` éšæ®µå®Œæˆ DOM è®Šæ›´å¾Œï¼ŒCSS `transition` ä»åœ¨è¦–è¦ºåŸ·è¡Œä¸­ã€‚è‹¥ `afterEnter()` ç«‹å³å•Ÿå‹•è¨ˆæ™‚å™¨æˆ–è§¸ç™¼å‰¯ä½œç”¨ï¼Œå¯èƒ½åœ¨å‹•ç•«æœªå®Œæˆæ™‚å°±é–‹å§‹æ–°æ“ä½œã€‚

**å”èª¿ç­–ç•¥**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     JS Transition vs CSS Animation Timeline              â”‚
â”‚                                                          â”‚
â”‚  JS:  â”ƒ beforeExit â”ƒ beforeEnter â”ƒ rAF(DOM) â”ƒ afterEnter â”‚
â”‚       0ms          ~2ms          ~16ms      ~18ms        â”‚
â”‚                                                          â”‚
â”‚  CSS: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”ƒ transition start â”€â”€â”€â”€ â”ƒ
â”‚                                 16ms              ~1816ms â”‚
â”‚                                                   (1.6s) â”‚
â”‚                                                          â”‚
â”‚  å”èª¿: afterEnter ä¸­çš„è¨ˆæ™‚å™¨å•Ÿå‹• â†’ OK (ä¸å½±éŸ¿è¦–è¦º)        â”‚
â”‚        afterEnter ä¸­çš„ DOM æ“ä½œ â†’ é¿å… (å¯èƒ½å¹²æ“¾ CSS)     â”‚
â”‚                                                          â”‚
â”‚  åŸå‰‡: afterEnter åƒ…åŸ·è¡Œï¼š                                â”‚
â”‚    âœ… å•Ÿå‹•/æ¸…é™¤è¨ˆæ™‚å™¨                                     â”‚
â”‚    âœ… dispatch äº‹ä»¶é€šçŸ¥                                   â”‚
â”‚    âœ… é‡‹æ”¾è½‰ç§»é–                                         â”‚
â”‚    âœ… requestFullscreen (é DOM æ“ä½œ)                     â”‚
â”‚    âŒ ä¿®æ”¹ DOM çµæ§‹/style (å¯èƒ½è§¸ç™¼ reflow å¹²æ“¾å‹•ç•«)      â”‚
â”‚    âŒ è§¸ç™¼é¡å¤–çš„ class åˆ‡æ› (å¯èƒ½è¦†è“‹æ­£åœ¨åŸ·è¡Œçš„ transition)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**CSS transition è¨­è¨ˆç´„æŸ**ï¼š

```css
/* æ‰€æœ‰æ¨¡å¼ç›¸é—œçš„å¯è¦‹æ€§è®ŠåŒ–ä½¿ç”¨çµ±ä¸€çš„æ™‚é–“å‡½æ•¸ */
.hero-dock-wrapper,
.hero-header,
.calendar-section,
.gallery-control-wrapper {
  transition: opacity 0.4s cubic-bezier(0.2, 0.8, 0.2, 1),
              transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* ä½¿ç”¨ opacity + pointer-events æ›¿ä»£ display:none */
/* é¿å… display:none â†’ display:flex ç„¡æ³•è§¸ç™¼ CSS transition */
body.immersion-mode:not(.mode-artwork) .hero-dock-wrapper {
  opacity: 0;
  pointer-events: none;
  /* ä¸ä½¿ç”¨ display:noneï¼Œè®“ transition å¯ä»¥å¹³æ»‘åŸ·è¡Œ */
}
```

### 11. äº‹ä»¶è¡çªèˆ‡å†’æ³¡æ§åˆ¶çŸ©é™£

**å•é¡Œ**ï¼šWelcome æ¨¡å¼ä¸‹ï¼Œclick äº‹ä»¶çš„è™•ç†éˆå­˜åœ¨ç«¶çˆ­ï¼š

```
ä½¿ç”¨è€…é»æ“Šç•«é¢
  â”œâ”€â”€ WelcomeOverlay.click (z:100005) â†’ transition-mode("calendar")
  â”‚     â””â”€â”€ e.stopPropagation() â† é˜»æ­¢å†’æ³¡
  â””â”€â”€ document.click (capture) â†’ bindBackgroundClick handler
        â””â”€â”€ isImmersion=true, isArtwork=false â†’ transition-mode("artwork") !!
```

**ç•¶å‰ä¿è­·**ï¼šWelcomeOverlay çš„ click handler å‘¼å« `e.stopPropagation()` é˜»æ­¢å†’æ³¡ï¼Œæ‰€ä»¥ bindBackgroundClick ä¸æœƒæ”¶åˆ°æ­¤äº‹ä»¶ã€‚

**ä½†é¢¨éšªåœ¨**ï¼š`bindBackgroundClick` ä½¿ç”¨ `capture: true`ï¼ˆ`document.addEventListener("click", handler, true)`ï¼‰ï¼Œcapture éšæ®µåœ¨ bubble éšæ®µä¹‹å‰åŸ·è¡Œã€‚å› æ­¤å¦‚æœ WelcomeOverlay çš„ handler åƒ…åœ¨ bubble éšæ®µ stop propagationï¼Œcapture handler ä»æœƒå…ˆè§¸ç™¼ã€‚

**é©—è­‰çµæœ**ï¼šç¨‹å¼ç¢¼ä¸­ `document.addEventListener("click", handler, true)` ç¢ºå¯¦ä½¿ç”¨ captureã€‚ä½† handler å…§æœ‰æ’é™¤é‚è¼¯ï¼š

```typescript
if (target.closest("button, a, input, ... #welcomeInteractionOverlay, ...")) return;
```

`#welcomeInteractionOverlay` åœ¨ closest æ’é™¤æ¸…å–®ä¸­ï¼Œæ‰€ä»¥å³ä½¿ capture å…ˆè§¸ç™¼ï¼Œä¹Ÿæœƒè¢«éæ¿¾ã€‚**ä½†é€™ä¾è³´ CSS selector å­—ä¸²çš„æ­£ç¢ºæ€§**ï¼Œç¶­è­·é¢¨éšªé«˜ã€‚

**æœ€ä½³å¯¦è¸**ï¼šåœ¨ `bindBackgroundClick` handler é–‹é ­åŠ å…¥æ¨¡å¼å®ˆè¡›ï¼š

```typescript
const handler = (e: MouseEvent) => {
  const currentMode = stateManager.getMode();
  // Welcome æ¨¡å¼çš„é»æ“Šç”± WelcomeOverlay å°ˆè²¬è™•ç†
  if (currentMode === "welcome") return;
  // ... å…¶é¤˜é‚è¼¯
};
```

### 12. éŒ¯èª¤æ¢å¾©èˆ‡å›æ»¾ç­–ç•¥

ç•¶æ¨¡å¼è½‰æ›éç¨‹ä¸­ç™¼ç”Ÿç•°å¸¸ï¼ˆå¦‚ fullscreen è«‹æ±‚è¢«æ‹’ã€DOM å…ƒç´ è¢«æ„å¤–ç§»é™¤ï¼‰ï¼Œç³»çµ±å¿…é ˆèƒ½å®‰å…¨æ¢å¾©ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Error Recovery Strategy                      â”‚
â”‚                                                    â”‚
â”‚  try {                                             â”‚
â”‚    beforeExit(from)                                â”‚
â”‚    beforeEnter(to)                                 â”‚
â”‚    performTransition()                             â”‚
â”‚    afterEnter(to)                                  â”‚
â”‚  } catch (error) {                                 â”‚
â”‚    // 1. è¨˜éŒ„è©³ç´°éŒ¯èª¤ (å« from/to/phase)            â”‚
â”‚    console.error(`[FSM] Transition ${from}â†’${to}   â”‚
â”‚      failed at phase: ${currentPhase}`, error);    â”‚
â”‚                                                    â”‚
â”‚    // 2. å›æ»¾è‡³å·²çŸ¥å®‰å…¨ç‹€æ…‹ (Calendar)              â”‚
â”‚    forceRecovery("calendar");                      â”‚
â”‚                                                    â”‚
â”‚    // 3. æ¸…é™¤æ‰€æœ‰è¨ˆæ™‚å™¨ (é˜²æ­¢æ®˜ç•™å›èª¿)              â”‚
â”‚    idleManager.deactivateAll();                    â”‚
â”‚    slideshowManager.stop();                        â”‚
â”‚                                                    â”‚
â”‚  } finally {                                       â”‚
â”‚    // 4. ç„¡è«–å¦‚ä½•é‡‹æ”¾è½‰ç§»é–                         â”‚
â”‚    isTransitioning = false;                        â”‚
â”‚    // 5. è™•ç†ä½‡åˆ— (è‹¥æœ‰)                            â”‚
â”‚    processQueue();                                 â”‚
â”‚  }                                                 â”‚
â”‚                                                    â”‚
â”‚  forceRecovery(mode):                              â”‚
â”‚    // å¼·åˆ¶é‡è¨­ body class è‡³ç›®æ¨™æ¨¡å¼                 â”‚
â”‚    // ä¸ç¶“éç”Ÿå‘½é€±æœŸï¼ˆé¿å…éè¿´éŒ¯èª¤ï¼‰                 â”‚
â”‚    body.className = "";                            â”‚
â”‚    if (mode === "calendar") {                      â”‚
â”‚      // Calendar ç„¡é¡å¤– classï¼Œæœ€å®‰å…¨çš„åŸºç¤ç‹€æ…‹     â”‚
â”‚    }                                               â”‚
â”‚    stateManager.mode = mode;                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº‹ä»¶å¥‘ç´„å®Œæ•´æ¸…å–® (Event Contract Registry)

### æ—¥æ›†äº‹ä»¶

| äº‹ä»¶åç¨± | Payload å‹åˆ¥ | ä¾†æº | æ¶ˆè²»è€… |
|----------|-------------|------|--------|
| `date-selected` | `DateSelectedDetail` `{day, month, year}` | CalendarEventHandlers | EventOrchestrator |
| `navigate-month` | `NavigateMonthDetail` `(-1\|1)` | CalendarEventHandlers / NavigationHandler | EventOrchestrator |
| `year-selected` | `number` | PanelEventHandlers | EventOrchestrator |
| `month-selected` | `number` | PanelEventHandlers | EventOrchestrator |
| `go-to-today` | `void` | Dock æŒ‰éˆ• | EventOrchestrator |
| `render-calendar` | `RenderCalendarDetail` | EventOrchestrator | CalendarRenderer |
| `update-calendar-title` | `UpdateCalendarTitleDetail` | EventOrchestrator | CalendarRenderer |

### æ¨¡å¼äº‹ä»¶

| äº‹ä»¶åç¨± | Payload å‹åˆ¥ | ä¾†æº | æ¶ˆè²»è€… |
|----------|-------------|------|--------|
| `transition-mode` | `{to: AppMode}` | ä»»æ„è§¸ç™¼å™¨ | ModeHandler |
| `mode-changed` | `ModeChangedDetail` `{from, to}` | ModeHandler | å…¨åŸŸç›£è½è€… |
| `welcome-mode` | `{active: boolean, targetMode?}` | WelcomeOverlay | EventOrchestrator |

### Hero äº‹ä»¶

| äº‹ä»¶åç¨± | Payload å‹åˆ¥ | ä¾†æº | æ¶ˆè²»è€… |
|----------|-------------|------|--------|
| `render-hero` | `RenderHeroDetail` | EventOrchestrator | ImageManager |
| `request-hero-change` | `RequestHeroChangeDetail` | NavigationHandler | EventOrchestrator |
| `slideshow-control` | `SlideshowControlDetail` `{action, isArtwork?}` | ModeHandler | SlideshowManager |
| `artwork-idle-slide` | `void` | IdleManager | NavigationHandler |

### UI äº‹ä»¶

| äº‹ä»¶åç¨± | Payload å‹åˆ¥ | ä¾†æº | æ¶ˆè²»è€… |
|----------|-------------|------|--------|
| `toggle-panel` | `string \| {type, force?}` | Dock æŒ‰éˆ• | PanelEventHandlers |
| `close-panels` | `ClosePanelsDetail` `{showGrid}` | å¤šè™• | PanelEventHandlers |
| `toggle-grid` | `void` | Dock æŒ‰éˆ• | CalendarEventHandlers |
| `toggle-grid-view` | `ToggleGridViewDetail` `{show}` | EventOrchestrator | CalendarEventHandlers |
| `render-panels` | `RenderPanelsDetail` | EventOrchestrator | PanelRenderers |

### ç”Ÿå‘½é€±æœŸäº‹ä»¶

| äº‹ä»¶åç¨± | Payload å‹åˆ¥ | ä¾†æº | æ¶ˆè²»è€… |
|----------|-------------|------|--------|
| `app-logic-ready` | `void` | AppController | ResourceLoader |
| `app-images-preloaded` | `void` | ImageManager | ResourceLoader |
| `loader-finished` | `void` | ResourceLoader | AppController |
| `music-restored` | `void` | MusicPlayer | UI åŒæ­¥ |
| `today-panel-rendered` | `void` | PanelRenderers | PanelEventHandlers |

---

## è¤‡é›œåº¦è¿½è¹¤

| é …ç›® | ç‚ºä½•éœ€è¦ | ç‚ºä½•æ‹’çµ•æ›´ç°¡å–®çš„æ›¿ä»£æ–¹æ¡ˆ |
|------|----------|--------------------------|
| äº”ç¨®æ“ä½œæ¨¡å¼ | ç”¢å“å®šä½ã€Œæ™‚é–“çš„è—è¡“å“ã€éœ€è¦å¤šå±¤æ¬¡é«”é©— | ä¸‰ç¨®æ¨¡å¼ç„¡æ³•å€åˆ†ã€Œæ“ä½œä¸­æ²‰æµ¸ã€èˆ‡ã€Œç´”æ·¨æ²‰æµ¸ã€ |
| é›™è‰²ç³»åŒæ­¥ | é™ä½èªçŸ¥è² è·çš„é—œéµè¨­è¨ˆå†³ç­– | å–®è‰²ç³»ç„¡æ³•è¡¨é”æ¨¡å¼åŠŸèƒ½èªç¾© |
| EventOrchestrator ä¸­å¿ƒåŒ– | 30+ æ¨¡çµ„é–“é€šè¨Šéœ€è¦è§£è€¦ | ç›´æ¥å¼•ç”¨æœƒå°è‡´å¾ªç’°ä¾è³´ |
| IdleManager ä¸‰åŸŸè¨ˆæ™‚å™¨ | æ­¡è¿/æ˜ ç•«æ¨¡å¼çš„é–’ç½®éœ€æ±‚ä¸åŒï¼Œè‡ªå‹•æ›åœ–éœ€ç¨ç«‹é‹ä½œ | å–®ä¸€è¨ˆæ™‚å™¨ç„¡æ³•è¦†è“‹ 6s/15s å…©ç¨®å ´æ™¯ï¼›é›™è¨ˆæ™‚å™¨å…±äº« reset() å°è‡´èªç¾©æ··äº‚ |
| åŠ è¼‰é–€é– (Logic Gate) | é˜²æ­¢é‚è¼¯æœªå°±ç·’æ™‚é¡¯ç¤ºä¸å®Œæ•´ UI | ç´”è³‡æºé€²åº¦æ¢ç„¡æ³•ä¿éšœé‚è¼¯å®‰å…¨ |
| FSM è½‰ç§»é– + ä½‡åˆ— | é«˜é »æ“ä½œä¸‹é¿å…å¤šé‡è½‰æ›é‡ç–Šå°è‡´ DOM æ±¡æŸ“ | ç´” debounce æœƒä¸Ÿæ£„åˆæ³•çš„æ“ä½œæ„åœ– |
| åŸå­ Class æ›¿æ› | æ¶ˆé™¤ä¸­é–“å¹€ç„¡ class é€ æˆçš„ CSS é¸æ“‡å™¨å¤±æ•ˆ | å…ˆæ¸…ç©ºå†æ·»åŠ çš„å¯«æ³•ç°¡å–®ä½†æœƒé–ƒçˆ |
| Fullscreen é™ç´šç­–ç•¥ | iOS Safari ä¸æ”¯æ´ programmatic fullscreen | ä¸é™ç´šæœƒå°è‡´ Zen æ¨¡å¼åœ¨ iOS ä¸Šè¡Œç‚ºç•°å¸¸ |
| Fullscreen ç”Ÿå‘½é€±æœŸæ•´åˆ | åˆ†æ•£çš„ fullscreen å‘¼å«èˆ‡è½‰æ›ç”Ÿå‘½é€±æœŸæ™‚åºè¡çª | ç¨ç«‹å‘¼å«ç„¡æ³•è¢«è½‰ç§»é–ä¿è­·ï¼Œå¤±æ•—é™ç´šç„¡æ³•è¢«çµ±ä¸€è™•ç† |
| CSS-driven visibility | æ¶ˆé™¤ inline style èˆ‡ CSS class çš„å„ªå…ˆæ¬Šè¡çª | JS ç›´æ¥æ“ä½œ style æœƒæ®˜ç•™ inline styleï¼Œè¦†è“‹ CSS è¦å‰‡ï¼Œå¢åŠ ç‹€æ…‹åŒæ­¥è² æ“” |
| toggle-grid èªç¾©æ‹†åˆ† | äº‹ä»¶åèˆ‡è¡Œç‚ºä¸ç¬¦é€ æˆç¶­è­·æ··äº‚ | é‡è¼‰è¨­è¨ˆé•åå‘½åå³æ–‡ä»¶åŸå‰‡ï¼Œæ–°é–‹ç™¼è€…ç„¡æ³•å¾äº‹ä»¶åæ¨æ–·è¡Œç‚º |
| éŒ¯èª¤æ¢å¾©å›æ»¾ç­–ç•¥ | è½‰æ›ä¸­é€”ç•°å¸¸éœ€å®‰å…¨æ¢å¾©è‡³ Calendar | ä¸è™•ç†ç•°å¸¸æœƒå°è‡´æ‡‰ç”¨å¡åœ¨ä¸ä¸€è‡´ç‹€æ…‹ï¼ˆå¦‚è½‰ç§»é–æ°¸ä¹…é–å®šï¼‰ |

---

## ä»£ç¢¼å¯©é–±ç™¼ç¾èˆ‡å„ªåŒ–å»ºè­° (Code Review Findings)

æœ¬ç¯€è¨˜éŒ„å°æ—¢æœ‰ç¨‹å¼ç¢¼çš„å¯©é–±çµæœèˆ‡å…·é«”å„ªåŒ–å»ºè­°ã€‚

### ç™¼ç¾ 1ï¼šBody Class é–ƒçˆ (Critical)

**æª”æ¡ˆ**ï¼š`src/scripts/app/stateManager.ts` â€” `setMode()`

**å•é¡Œ**ï¼šç•¶å‰å¯¦ä½œå…ˆç§»é™¤æ‰€æœ‰æ¨¡å¼ classï¼Œå†æ·»åŠ æ–° classã€‚åœ¨é«˜å¹€ç‡è¢å¹•ï¼ˆ120Hz+ï¼‰ä¸Šï¼Œé€™æœƒåœ¨ç§»é™¤èˆ‡æ·»åŠ ä¹‹é–“ç”¢ç”Ÿ 1 å¹€çš„ç„¡ class ç‹€æ…‹ï¼Œå°è‡´ä¾è³´ body class çš„ CSS å¾Œä»£é¸æ“‡å™¨çŸ­æš«å¤±æ•ˆï¼Œé€ æˆï¼š
- Dock åœ¨åˆ‡æ›ç¬é–“é–ƒç¾/æ¶ˆå¤±
- CalendarBoard åœ¨ Artwork æ¨¡å¼ä¸‹çŸ­æš«é¡¯ç¤º
- è‰²ç³»è®Šæ•¸è·³å‹•

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šæ”¹ç”¨åŸå­æ›¿æ›ï¼ˆè¦‹ Â§2.1 Atomic Class Swap Tableï¼‰ï¼Œåœ¨ `requestAnimationFrame` å…§å…ˆ add å¾Œ removeã€‚

### ç™¼ç¾ 2ï¼šIdleManager é›™é‡ reset() (High)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/handlers/modeHandler.ts` â€” `applyModeSideEffects()`

**å•é¡Œ**ï¼šé€²å…¥ Artwork æ¨¡å¼æ™‚ï¼Œ`applyModeSideEffects` å…ˆå‘¼å« `idleManager.clear()` å†å‘¼å« `idleManager.reset()`ã€‚ä½† `reset()` ç™¼å‡ºçš„ `slideshow-control: start` äº‹ä»¶æœ€çµ‚åˆè§¸ç™¼ `idleManager.setArtworkMode(true)` â†’ `restartArtworkTimer()` â†’ `idleManager.reset()`ï¼Œå°è‡´ `reset()` è¢«å‘¼å«å…©æ¬¡ã€‚

**å½±éŸ¿**ï¼š
- é–’ç½®è¨ˆæ™‚å™¨è¢«ä¸å¿…è¦åœ°é‡å•Ÿ
- 200ms debounce é‚è¼¯å¶çˆ¾å¤±æ•ˆï¼ˆå› å…©æ¬¡ reset é–“éš” > 200msï¼‰
- DevTools ä¸­å¯è¦‹å¤šé¤˜çš„ setTimeout å †ç–Š

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šè¦‹ Â§1.4 IdleManager é‡æ§‹æ–¹æ¡ˆã€‚

### ç™¼ç¾ 3ï¼šç¼ºå°‘è½‰ç§»å®ˆè¡› (High)

**æª”æ¡ˆ**ï¼š`src/scripts/app/eventOrchestrator.ts` â€” `transitionMode()`

**å•é¡Œ**ï¼šç•¶å‰åªæª¢æŸ¥ `from === to`ï¼ˆåŒæ¨¡å¼ä¸è½‰æ›ï¼‰ï¼Œä½†ä¸é©—è­‰è½‰æ›è·¯å¾‘çš„åˆæ³•æ€§ã€‚ä¾‹å¦‚ï¼š
- `CalendarEventHandlers` ä¸­çš„ `toggle-grid` å¯ä»¥ç›´æ¥è§¸ç™¼ `Welcome â†’ Calendar`
- IdleManager å¯ä»¥å¾ Welcome ç›´æ¥è·³åˆ° Zenï¼Œè·³é Calendar/Artwork

**å½±éŸ¿**ï¼šé›–ç„¶ç›®å‰æœªé€ æˆé¡¯è‘— Bugï¼Œä½†åœ¨æ–°å¢åŠŸèƒ½æˆ–ä¿®æ”¹äº‹ä»¶æµæ™‚ï¼Œé›£ä»¥ä¿è­‰ä¸æœƒå¼•å…¥éæ³•è½‰æ›è·¯å¾‘ã€‚

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šåœ¨ `transitionMode()` ä¸­å¢åŠ åˆæ³•æ€§é©—è­‰ï¼ˆè¦‹ Â§1.2 Transition Tableï¼‰ã€‚

### ç™¼ç¾ 4ï¼šé¢æ¿ç‹€æ…‹æœªæ¸…ç† (Medium)

**æª”æ¡ˆ**ï¼š`src/scripts/app/stateManager.ts` â€” `setMode()`

**å•é¡Œ**ï¼šæ¨¡å¼åˆ‡æ›æ™‚ä¸ä¸»å‹•æ¸…ç† `activePanel` ç‹€æ…‹ã€‚é›–ç„¶ `applyModeSideEffects` æœƒ dispatch `close-panels` äº‹ä»¶ï¼Œä½†ä¾è³´äº‹ä»¶è§¸ç™¼çš„ç•°æ­¥è™•ç†ä¾†æ¸…ç†ç‹€æ…‹ï¼Œå­˜åœ¨æ™‚åºé¢¨éšªï¼š
1. `setMode('artwork')` è¢«å‘¼å«
2. body class å·²æ›´æ–°ç‚º immersion
3. `close-panels` äº‹ä»¶è¢« dispatch
4. event handler ç•°æ­¥åŸ·è¡Œï¼Œæ­¤æ™‚ `activePanel` ä»ç‚º `'today'`
5. åœ¨æ­¥é©Ÿ 3-4 ä¹‹é–“å¦‚æœ‰ç¨‹å¼æŸ¥è©¢ `activePanel`ï¼Œæœƒå¾—åˆ°éæœŸå€¼

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šåœ¨ `setMode()` å…§ï¼Œå°é panel-friendly æ¨¡å¼ï¼ˆ`artwork`, `zen`, `welcome`ï¼‰ä¸»å‹•å°‡ `activePanel` è¨­ç‚º `null`ã€‚

### ç™¼ç¾ 5ï¼šå‹åˆ¥å®‰å…¨ç¼ºå£ (Medium)

**æª”æ¡ˆ**ï¼š`src/scripts/types.ts`

**å•é¡Œ**ï¼š`RenderHeroDetail.lunar` è¢«å®šç¾©ç‚º `any`ï¼Œé•åæ†²ç« ç¬¬ III æ¢ã€Œåš´ç¦ä½¿ç”¨ any é¡å‹ã€ã€‚

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šå®šç¾© `LunarData` interface æˆ–ä½¿ç”¨ `import type { Lunar }` ä¸¦è§£æ±ºå¾ªç’°ä¾è³´ã€‚

### ç™¼ç¾ 6ï¼šUI å…ƒç´ å¯è¦‹æ€§ç®¡ç†ç¢ç‰‡åŒ– (Medium)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/ui/modeUIManager.ts`, `layoutManager.ts`

**å•é¡Œ**ï¼šå…ƒç´ çš„å¯è¦‹æ€§é€éå¤šç¨®æ–¹å¼æ§åˆ¶ï¼Œç¼ºä¹ä¸€è‡´æ€§ï¼š
- æœ‰äº›ç”¨ `style.display = 'none'`
- æœ‰äº›ç”¨ `style.opacity = '0'` + `style.pointerEvents = 'none'`
- æœ‰äº›ç”¨ `classList.add/remove`
- CSS ä¸­ä¹Ÿé€é body class å¾Œä»£é¸æ“‡å™¨æ§åˆ¶ display

é€™ä½¿å¾—è¿½è¹¤æŸå€‹å…ƒç´ åœ¨ç‰¹å®šæ¨¡å¼ä¸‹çš„å¯è¦‹æ€§è®Šå¾—å›°é›£ã€‚

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šçµ±ä¸€ç‚ºã€ŒCSS-driven visibilityã€â€”â€”æ‰€æœ‰æ¨¡å¼ç›¸é—œçš„å¯è¦‹æ€§ç”± body class å¾Œä»£é¸æ“‡å™¨åœ¨ CSS å±¤æ§åˆ¶ï¼ŒJS å±¤ä¸å†ç›´æ¥æ“ä½œ `style.display` æˆ– `style.opacity`ã€‚JS åƒ…è² è²¬åˆ‡æ› body classã€‚

### ç™¼ç¾ 7ï¼šFullscreen é‚è¼¯æ•£è½ (High)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/uiManager.ts` â€” `bindBackgroundClick()`, `toggleFullscreen()`

**å•é¡Œ**ï¼šFullscreen çš„é€²å…¥/é€€å‡ºåœ¨ `bindBackgroundClick()` handler å…§ç›´æ¥å‘¼å«ï¼Œæœªæ•´åˆè‡³æ¨¡å¼è½‰æ›ç”Ÿå‘½é€±æœŸï¼š

```typescript
// ç¾è¡Œç¨‹å¼ç¢¼ â€” uiManager.bindBackgroundClick()
if (isArtwork) {
    window.dispatchEvent(new CustomEvent("transition-mode", { detail: { to: "zen" } }));
    this.toggleFullscreen(true); // â† ç¨ç«‹æ–¼è½‰æ›ç”Ÿå‘½é€±æœŸï¼
    return;
}
```

è€Œ `modeHandler.applyModeSideEffects()` ä¸­ `zen` åˆ†æ”¯**ä¸å«** fullscreen é‚è¼¯ã€‚

**å½±éŸ¿**ï¼š
- `transition-mode` äº‹ä»¶ç•°æ­¥è™•ç†ï¼Œ`toggleFullscreen()` åŒæ­¥å‘¼å«â€”â€”åŸ·è¡Œé †åºä¸ç¢ºå®š
- è½‰ç§»é–æ©Ÿåˆ¶ï¼ˆè‹¥å¼•å…¥ï¼‰ç„¡æ³•è¦†è“‹ fullscreen æ“ä½œ
- Fullscreen å¤±æ•—çš„é™ç´šè™•ç†å­¤ç«‹æ–¼è½‰æ›ç”Ÿå‘½é€±æœŸå¤–

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šè¦‹ Â§8 Fullscreen ç”Ÿå‘½é€±æœŸæ•´åˆæ–¹æ¡ˆã€‚

### ç™¼ç¾ 8ï¼šWelcome é–’ç½®è¶…æ™‚å€¼éŒ¯èª¤ (Critical)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/idleManager.ts` â€” å»ºæ§‹å­

**å•é¡Œ**ï¼š`HeroIdleManager` å»ºæ§‹å­è¨ˆæ™‚å™¨é è¨­å€¼ `idleTimeout = 15000`ï¼ˆ15 ç§’ï¼‰ï¼Œä½†è¦æ ¼è¦æ±‚ Welcome æ¨¡å¼é–’ç½® **6 ç§’** é€²å…¥ Zenã€‚ç›®å‰ Welcome èˆ‡ Artwork å…±ç”¨åŒä¸€å€‹ `IDLE_TIMEOUT`ï¼Œå°è‡´ Welcome æ¨¡å¼å¯¦éš›ç­‰å¾… 15 ç§’æ‰è§¸ç™¼è‡ªå‹•è½‰å ´â€”â€”æ˜¯è¦æ ¼å®šç¾©çš„ 2.5 å€ã€‚

```typescript
// ç¾è¡Œç¨‹å¼ç¢¼
constructor(idleTimeout = 15000) {  // â† Welcome ä¹Ÿç”¨ 15sï¼
    this.IDLE_TIMEOUT = idleTimeout;
}
```

**å½±éŸ¿**ï¼š
- æ­¡è¿æ¨¡å¼çš„é–’ç½®è‡ªå‹•è½‰å ´æ™‚é–“ç‚º 15 ç§’è€Œé 6 ç§’
- ä½¿ç”¨è€…ç­‰å¾…æ™‚é–“éé•·ï¼Œå½±éŸ¿é¦–æ¬¡é«”é©—çš„ã€Œå„€å¼æ„Ÿã€æµæš¢åº¦
- ç›´æ¥é•å User Story 1 é©—æ”¶æƒ…å¢ƒ #4

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šä¸‰åŸŸè¨ˆæ™‚å™¨é‡æ§‹ï¼ˆÂ§1.4ï¼‰ï¼Œä½¿ç”¨ç¨ç«‹è¶…æ™‚å¸¸é‡ã€‚

### ç™¼ç¾ 9ï¼štoggle-grid èªç¾©é‡è¼‰ (Medium)

**æª”æ¡ˆ**ï¼š`src/scripts/app/eventOrchestrator.ts` â€” `setupPanelEvents()`

**å•é¡Œ**ï¼š`toggle-grid` äº‹ä»¶ handler è¢«é‡è¼‰ç‚ºæ¨¡å¼åˆ‡æ›è§¸ç™¼å™¨ï¼Œåœ¨å¤§å¤šæ•¸æ¨¡å¼ä¸‹å¯¦éš›ä¸åŸ·è¡Œ grid toggleï¼Œè€Œæ˜¯ dispatch `transition-mode`ã€‚äº‹ä»¶åç¨±èˆ‡å¯¦éš›è¡Œç‚ºåš´é‡ä¸ç¬¦ã€‚

**å½±éŸ¿**ï¼š
- é•åæ†²ç«  Â§VI å‘½ååŸå‰‡ï¼ˆå‘½åå³æ–‡ä»¶ï¼‰
- è¿½è¹¤äº‹ä»¶æµæ™‚å¼•èµ·æ··æ·†
- `btnDay` æŒ‰éˆ•çš„èªç¾©åœ¨ä¸åŒæ¨¡å¼ä¸‹ä¸ä¸€è‡´

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šè¦‹ Â§9 toggle-grid äº‹ä»¶èªç¾©é‡æ–°å®šç¾©ã€‚

### ç™¼ç¾ 10ï¼šlayoutManager.updatePanelsForType ç¡¬æ“ä½œ style (Medium)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/ui/layoutManager.ts` â€” `updatePanelsForType()`

**å•é¡Œ**ï¼š`updatePanelsForType()` ç›´æ¥é€é `style.opacity` / `style.display` / `style.pointerEvents` æ§åˆ¶ Headerã€Dockã€YearMonth æŒ‰éˆ•çš„å¯è¦‹æ€§ï¼š

```typescript
// ç¾è¡Œç¨‹å¼ç¢¼
if (type === "today") {
    if (this.btnYearMonth) { this.btnYearMonth.style.display = "none"; }
    if (this.heroHeader) { this.heroHeader.style.opacity = "0"; }
    if (this.heroDockWrapper) { this.heroDockWrapper.style.opacity = "0"; }
}
```

æ­¤æ“ä½œçš„ inline style å„ªå…ˆæ¬Šé«˜æ–¼ CSS class è¦å‰‡ï¼Œæœƒè¦†è“‹ body class å¾Œä»£é¸æ“‡å™¨çš„è¡Œç‚ºï¼Œå°è‡´ï¼š
- é¢æ¿é—œé–‰å¾Œ Header/Dock çš„ opacity å¯èƒ½ä»ç‚º 0ï¼ˆinline style æ®˜ç•™ï¼‰
- CSS-driven visibility ç­–ç•¥è¢«æ¶ç©º

**å½±éŸ¿**ï¼š
- `toggleGridView(true)` éœ€é¡å¤–é‚„åŸ `style.opacity = "1"`ï¼Œå½¢æˆè„†å¼±çš„é›™å‘åŒæ­¥
- æ–°å¢æ¨¡å¼æ™‚å®¹æ˜“éºæ¼ style é‚„åŸ

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šæ”¹ç”¨ data attribute æˆ– CSS class æ›¿ä»£ inline styleï¼š

```typescript
// é‡æ§‹å¾Œ
if (type === "today") {
    document.body.setAttribute("data-active-panel", "today");
    // CSS: body[data-active-panel="today"] .hero-header { opacity: 0; }
}
```

### ç™¼ç¾ 11ï¼šcapture éšæ®µçš„èƒŒæ™¯é»æ“Šäº‹ä»¶é¢¨éšª (Low)

**æª”æ¡ˆ**ï¼š`src/scripts/hero/uiManager.ts` â€” `bindBackgroundClick()`

**å•é¡Œ**ï¼šä½¿ç”¨ `document.addEventListener("click", handler, true)` (capture éšæ®µ) æ””æˆªæ‰€æœ‰ click äº‹ä»¶ã€‚é›–ç„¶ handler å…§æœ‰ `target.closest(...)` æ’é™¤é‚è¼¯ï¼Œä½†æ’é™¤æ¸…å–®ä¾è³´ CSS selector å­—ä¸²ç¶­è­·ï¼š

```typescript
if (target.closest("button, a, input, textarea, select, .hero-dock, .hero-gallery-submenu, ...")) return;
```

æ–°å¢ UI å…ƒä»¶æ™‚å®¹æ˜“éºæ¼åŠ å…¥æ’é™¤æ¸…å–®ï¼Œå°è‡´æ„å¤–è§¸ç™¼æ¨¡å¼åˆ‡æ›ã€‚

**å„ªåŒ–æ–¹æ¡ˆ**ï¼šåœ¨ handler é–‹é ­åŠ å…¥æ¨¡å¼å®ˆè¡›ï¼Œä¸¦ä½¿ç”¨ `data-interactive` å±¬æ€§ä»£æ›¿ç¡¬ç·¨ç¢¼ selector æ¸…å–®ã€‚
